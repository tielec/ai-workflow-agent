# テスト実行フェーズ - 修正プロンプト

**重要: すべてのドキュメント内容を日本語で記述してください。すべてのセクション、説明、解説は日本語で書いてください。**

## ⚠️ 必須タスク
**test-result.md を必ず更新してください。**
Write ツールを使用して `.ai-workflow/issue-{issue_number}/06_testing/output/test-result.md` を**上書き保存**し、古い内容は完全に置き換えて最新のテスト結果のみを記録してください。
この更新を省略するとワークフローがエラーになります。

## タスク概要
レビューで指摘された問題を修正し、テストを再実行してください。

**重要**: Phase 5でテストが失敗した場合、**Phase 4（実装）に戻って実装を修正**する必要があります。

## レビュー結果
{review_feedback}

## 参考情報

### テスト結果
{test_result_document_path}

### 実装ログ
{implementation_document_path}

### テストシナリオ
{test_scenario_document_path}

## 修正指示

### ⚠️ 最重要: 必須ファイル更新
**Write ツールで `.ai-workflow/issue-{issue_number}/06_testing/output/test-result.md` を上書き保存**することを最優先で実行してください。内容は最新のテスト結果のみとし、古い記録は残さないでください。

### ブロッカー（BLOCKER）の解消

レビュー結果の「ブロッカー」セクションに記載された問題は、**次フェーズに進めない重大な問題**です。

**重要な判断**:
- **クリティカルなテスト失敗がある場合**: Phase 4に戻って実装を修正する必要があります
- **テスト環境の問題の場合**: テスト環境を修正してテストを再実行します

**Phase 4に戻る判断基準**:
- クリティカルパスのテストが失敗している
- 正常系のテストが失敗している
- 実装に明らかなバグがある

**Phase 5内で対応できる問題**:
- テスト環境の設定ミス
- テストデータの準備不足
- テスト実行コマンドの誤り

### 修正方針の決定

レビュー結果を確認し、以下のいずれかを選択してください：

#### 選択肢1: Phase 4に戻って実装を修正

実装に問題がある場合は、このプロンプトでは対応できません。
**Phase 4のrevise()を実行する必要があります**。

この場合、以下を記録してください：

```markdown
# テスト失敗による実装修正の必要性

## 修正が必要な理由
（なぜPhase 4に戻る必要があるか）

## 失敗したテスト
（どのテストが失敗したか）

## 必要な実装修正
（実装のどこをどう修正すべきか）
```

これを `.ai-workflow/issue-{issue_number}/06_testing/output/test-result.md` に上書き保存してください。古い内容は残さず、最新の判断と修正理由のみを記録してください。

#### 選択肢2: テスト環境を修正してテストを再実行

テスト環境に問題がある場合は、環境を修正してテストを再実行してください。

**修正手順**:
1. テスト環境の問題を特定
2. 環境を修正（依存パッケージのインストール、設定ファイルの修正等）
3. テストを再実行
4. テスト結果を記録

## 修正手順（チェックリスト）
- [ ] 1. レビュー結果を確認し、ブロッカー/改善提案を整理
- [ ] 2. 必要に応じて Phase 4 に戻る判断を明確にする
- [ ] 3. テスト環境を整備し、再実行の準備をする
- [ ] 4. **Write ツールで `.ai-workflow/issue-{issue_number}/06_testing/output/test-result.md` を上書き保存**（必須）
- [ ] 5. 修正後の品質ゲート（ブロッカー解消・主要テスト成功・次フェーズ準備）を確認

## 修正後の確認事項

修正完了後、以下を確認してください：

1. **ブロッカーが解消されたか**
   - レビューで指摘されたすべてのブロッカーに対応したか

2. **主要なテストが成功しているか**
   - クリティカルパスのテストが成功しているか

3. **次フェーズへの準備**
   - Phase 6（ドキュメント作成）に進めるか
   - またはPhase 4に戻る必要があるか

## テスト結果の更新

テストを再実行した場合は、`Write` ツールを使って `.ai-workflow/issue-{issue_number}/06_testing/output/test-result.md` を**上書き保存**してください。古い内容は完全に置き換え、最新の test-result.md のみを記録するようにしてください。以下のテンプレートは内容の構成例です（追記ではなく上書き前提です）：

```markdown
## 再実行結果

### 再実行1: YYYY-MM-DD HH:MM:SS
- **修正内容**: （何を修正したか）
- **成功**: Y個
- **失敗**: Z個
- **変更**: （前回からの変化）
```

## 出力形式

**重要**: 修正後のテスト結果を `.ai-workflow/issue-{issue_number}/06_testing/output/test-result.md` として**必ず上書き保存**してください。既存のファイルがある場合は、古い内容を完全に置き換えて、最新のテスト結果のみを記録してください。

## ⚠️ 重要: テストプロセスの実行に関する禁止事項（Issue #267）

**絶対にKillShellを使用しないでください。**

テストの実行には時間がかかることがあります（数分〜10分以上）。以下のルールを厳守してください：

### 禁止事項
- **KillShellの使用禁止**: テストプロセスを途中で強制終了しないでください
- **タイムアウトによる中断禁止**: テストが長時間実行されていても、完了まで待機してください
- **プロセスの手動終了禁止**: `kill`、`pkill`、`Ctrl+C` 相当の操作は行わないでください

### 推奨事項
- **十分なタイムアウト設定**: テスト実行コマンドには十分なタイムアウト（10分以上）を設定してください
- **バックグラウンド実行の活用**: 長時間テストは `run_in_background: true` オプションを使用し、`BashOutput` で結果を確認してください

**テストが完了するまで必ず待機してください。** テストプロセスを強制終了すると、テスト結果が不完全になり、ワークフローが失敗します。

## 修正開始

上記を踏まえ、適切な対応を実施してください。
