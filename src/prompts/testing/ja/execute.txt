# テスト実行フェーズ - 実行プロンプト

**重要: すべてのドキュメント内容を日本語で記述してください。すべてのセクション、説明、解説は日本語で書いてください。**

## タスク概要
Phase 5で実装したテストコードを実行し、結果を記録してください。

## ⚠️ このフェーズが不要と判断した場合の対応（Issue #411）

**重要**: このIssueでテスト実行が不要と判断した場合でも、**必ずtest-result.mdファイルを作成**してください。
ファイルが作成されないと、ワークフローがエラーで停止します。

### スキップ判断の基準
以下のような場合、テスト実行をスキップすることが適切です：
- Phase 5でテストコード実装がスキップされた場合
- ドキュメント修正のみのIssue
- ファイル削除のみのIssue
- 設定ファイルの微修正のみのIssue
- テスト対象となる実装コードが存在しないIssue

### スキップ時のファイル作成（必須）
スキップすると判断した場合、以下のテンプレートで必ずtest-result.mdを作成してください：

```markdown
# テスト実行結果

## スキップ判定
このIssueではテスト実行が不要と判断しました。

## 判定理由
- （具体的な理由を箇条書きで記載）
- 例: Phase 5でテストコード実装がスキップされたため、実行するテストが存在しない
- 例: ドキュメント修正のみのため、テスト実行は不要

## 次フェーズへの推奨
Phase 7（Documentation）へ進んでください。
```

**注意**: Phase 5でtest-implementation.mdにスキップ判定が記載されている場合は、このフェーズもスキップすることを推奨します。

## 入力情報

### Planning Phase成果物
- Planning Document: {planning_document_path}

**注意**: Planning Phaseが実行されている場合、開発計画（実装戦略、テスト戦略、リスク、スケジュール）を必ず確認してください。

### テスト実装ログ（利用可能な場合）
{test_implementation_context}
<!--
  存在する場合: @test-implementation.md への参照
  存在しない場合: "テストコード実装ログは利用できません。実装コードを直接確認してテストを実行してください。"
-->

### 実装ログ（利用可能な場合）
{implementation_context}
<!--
  存在する場合: @implementation.md への参照
  存在しない場合: "実装ログは利用できません。リポジトリの実装コードを直接確認してください。"
-->

### テストシナリオ（利用可能な場合）
{test_scenario_context}
<!--
  存在する場合: @test-scenario.md への参照
  存在しない場合: "テストシナリオは利用できません。実装内容に基づいて適切なテストを実施してください。"
-->

## テスト実行手順

### 1. テストコードの確認

テスト実装ログに記載されたテストファイルを確認してください：
- 実装されたテストファイルのパス
- テストフレームワーク（pytest, unittest, behave等）
- テスト実行コマンド

### 2. テスト環境の準備

テストを実行する前に、以下の手順で環境を整えてください。

#### 2-1. 対象プロジェクトの言語・ランタイム確認と準備

プロジェクトが依存する言語・ランタイムバージョンを確認し、必要に応じてインストールします：
- `README.md`、`.python-version`、`.nvmrc`、`.tool-versions` 等を参照して要件を特定
- 前述の「🛠️ 開発環境情報」セクションを参照し、必要なランタイムを導入します

#### 2-2. 依存パッケージのインストール

対象言語ごとに依存関係をインストールしてください：

**Python**:
```bash
pip install -r requirements.txt
# または
pip install -e .
```

**Node.js**:
```bash
npm install
# または
yarn install
```

**Go**:
```bash
go mod download
```

**Ruby**:
```bash
bundle install
```

**Java**:
```bash
mvn install -DskipTests
# または
gradle build -x test
```

#### 2-3. テストフレームワークの確認とセットアップ

Phase 5のテスト実装ログで使用されているテストフレームワークを確認し、未インストールであれば個別にインストールします：

```bash
# Python: pytest の場合
pip install pytest

# Node.js: Jest の場合
npm install --save-dev jest

# その他フレームワークも同様に個別インストール
```

#### 2-4. テスト実行の前提条件チェック

以下を確認・準備してください：
- `pytest.ini`、`jest.config.js`、`.env.test` などの設定ファイルの存在
- テスト用環境変数（例: テスト用DB接続文字列）の設定
- テストデータ（フィクスチャ・シードデータなど）の準備

#### 2-5. 環境準備結果の記録

実施した環境準備内容は `test-result.md` の「環境準備サマリー」セクションに記録します：
- インストールした言語・バージョン
- インストールしたパッケージ・バージョン
- 使用したテストフレームワーク
- 発生した問題とその対処

### 3. テストの実行

適切なテストコマンドを実行してください：

**Pytestの場合**:
```bash
pytest tests/
```

**Unittestの場合**:
```bash
python -m unittest discover tests/
```

**Behave（BDD）の場合**:
```bash
behave tests/features/
```

**プロジェクト固有のテストコマンド**:
- @README.md や@CONTRIBUTION.md にテスト実行方法が記載されている場合があります
- 既存のテストスクリプトがあれば参考にしてください

### 4. テスト結果の記録

テスト結果を以下の形式で記録してください：

```markdown
# テスト実行結果

## 環境準備サマリー
- インストールした言語: （例: Python 3.11）
- インストールしたパッケージ: （例: requirements.txt（42パッケージ））
- テストフレームワーク: （例: pytest 7.4.0）
- 準備で発生した問題: （なし、または問題内容）

## テスト結果サマリー

以下の形式で数値サマリーを記載してください：
- 総テスト数: X件
- 成功: Y件
- 失敗: Z件
- 成功率: XX%

## 条件分岐

**成功時（失敗数が0件）**:
✅ 全てのテストが成功しました。

**失敗時（失敗数が1件以上）**:
以下の形式で失敗したテストの詳細のみを記載してください：

### `tests/test_xxx.py::test_function_name`
- **エラー**: （エラーメッセージ）
- **スタックトレース**:
  ```
  （関連する部分のみ抜粋）
  ```

**注意**: 成功したテストの詳細リストは記載しないでください。
```

このログを `.ai-workflow/issue-{issue_number}/06_testing/output/test-result.md` として保存してください。

## 品質ゲート（Phase 6）

テスト実行は以下の品質ゲートを満たす必要があります：

- [ ] **テストが実行されている**
- [ ] **主要なテストケースが成功している**
- [ ] **失敗したテストは分析されている**

これらの品質ゲートは**必須要件**です。テスト実行後、クリティカルシンキングレビューが実施されます。

## 注意事項

1. **テスト環境**: 適切なテスト環境で実行
   - 必要な依存パッケージがインストールされているか確認
   - テストデータが準備されているか確認

2. **失敗の分析**: テストが失敗した場合は詳細に分析
   - エラーメッセージを記録
   - 原因を特定
   - 修正方針を明記

3. **完全性**: すべてのテストを実行
   - 一部だけでなく、すべてのテストを実行
   - スキップされたテストがある場合は理由を記載

4. **客観性**: 結果を正直に記録
   - 失敗を隠さない
   - 成功・失敗を正確に報告

5. **レビューされることを意識**: テスト結果はクリティカルシンキングレビューが実施されます
   - 品質ゲート（3つの必須要件）を満たすこと
   - テスト失敗時は原因分析と対処方針を明記

## ⚠️ 重要: テストプロセスの実行に関する禁止事項（Issue #267）

**絶対にKillShellを使用しないでください。**

テストの実行には時間がかかることがあります（数分〜10分以上）。以下のルールを厳守してください：

### 禁止事項
- **KillShellの使用禁止**: テストプロセスを途中で強制終了しないでください
- **タイムアウトによる中断禁止**: テストが長時間実行されていても、完了まで待機してください
- **プロセスの手動終了禁止**: `kill`、`pkill`、`Ctrl+C` 相当の操作は行わないでください

### 推奨事項
- **十分なタイムアウト設定**: テスト実行コマンドには十分なタイムアウト（10分以上）を設定してください
- **バックグラウンド実行の活用**: 長時間テストは `run_in_background: true` オプションを使用し、`BashOutput` で結果を確認してください
- **段階的な実行**: テストスイートが大きい場合は、ディレクトリやファイル単位で分割実行することを検討してください

### テスト実行時間の目安
- 小規模プロジェクト: 1-3分
- 中規模プロジェクト: 3-10分
- 大規模プロジェクト: 10分以上

**テストが完了するまで必ず待機してください。** テストプロセスを強制終了すると、テスト結果が不完全になり、ワークフローが失敗します。

### 長時間テストの実行例

```bash
# 推奨: バックグラウンドで実行し、完了を待機
# Bashツールで run_in_background: true を使用
npm test

# その後、BashOutputで結果を確認
# テストが完了するまで定期的にBashOutputで状態を確認
```

## テスト実行開始

上記を踏まえ、テストを実行し、結果を記録してください。
