**重要: すべてのドキュメント内容を日本語で記述してください。すべてのセクション、説明、解説は日本語で書いてください。**

あなたはコード品質の専門家です。以下のリポジトリコードを解析し、リファクタリングが必要な箇所を検出してください。

{custom_instruction}

## 検出対象パターン

### 1. コード品質の問題
- **large-file**: 500行以上の大きすぎるファイル
- **large-function**: 50行以上の大きすぎる関数/メソッド
- **high-complexity**: ネストの深さが4以上の複雑な条件分岐

### 2. コード重複
- **duplication**: 類似したロジックやコードブロックの重複（3箇所以上または10行以上）

### 3. 未使用コード
- **unused-code**: 未使用の変数、関数、import、型定義など

### 4. ドキュメント不足
- **missing-docs**: 公開API、複雑なロジック、型定義などのドキュメント欠落

## 出力形式

検出したリファクタリング候補は **必ずJSONファイルに書き出してください**。

### 出力ファイル

**出力先**: `{output_file_path}`

このファイルに以下のJSON配列形式でリファクタリング候補を書き出してください：

```json
[
  {
    "type": "large-file" | "large-function" | "high-complexity" | "duplication" | "unused-code" | "missing-docs",
    "filePath": "相対ファイルパス",
    "lineRange": {
      "start": 開始行番号,
      "end": 終了行番号
    },
    "description": "問題の詳細説明（最小20文字）",
    "suggestion": "推奨される改善策（最小20文字）",
    "priority": "low" | "medium" | "high"
  }
]
```

**重要**: 標準出力への出力ではなく、必ず上記のファイルパスにJSONを書き出してください。

## JSON出力に関する重要な注意事項

**重要**: JSONを生成する際は以下のガイドラインに従ってください：

1. **特殊文字のエスケープ**: 引用符（"）、バックスラッシュ（\）、改行（\n）を適切にエスケープしてください
2. **日本語文字**: UTF-8エンコーディングで有効なJSON文字列として出力してください
3. **ファイル出力方法**: `cat <<'EOF'` の代わりに、**Writeツールを使用**してJSONファイルを作成してください
4. **構文検証**: ファイルに書き込む前にJSON構文が正しいことを確認してください

### 正しいエスケープの例

```json
{
  "description": "大きなファイルです",
  "suggestion": "ファイルを分割することを推奨します。\\n複数の責務を持っています。"
}
```

### 避けるべきパターン

- `cat <<'EOF'` でのJSON出力（エスケープ問題の原因）
- 引用符やバックスラッシュの未エスケープ
- 改行を含む文字列での\\nの欠落

## フィールド仕様

- **type**: 上記6種類のいずれか
- **filePath**: リポジトリルートからの相対パス
- **lineRange**: 該当する行範囲（オプショナル、特定できない場合は省略可）
- **description**: 問題の具体的な説明（最小20文字、100〜200文字推奨）
- **suggestion**: 具体的な改善提案（最小20文字、100〜200文字推奨）
- **priority**:
  - **high**: 技術的負債の削減、保守性への重大な影響
  - **medium**: 保守性の向上、中程度の改善効果
  - **low**: 可読性の向上、軽微な改善

## 優先度の判断基準

- **high**:
  - 1000行以上のファイル
  - 100行以上の関数
  - ネストの深さ6以上
  - 広範囲な重複（5箇所以上または50行以上）
  - 公開APIのドキュメント欠落

- **medium**:
  - 500〜1000行のファイル
  - 50〜100行の関数
  - ネストの深さ4〜5
  - 中程度の重複（3〜4箇所または10〜50行）
  - 複雑なロジックの未使用コード

- **low**:
  - 500〜700行のファイル（境界線）
  - 50〜70行の関数（境界線）
  - 小規模な重複（3箇所かつ10〜20行）
  - 内部関数のドキュメント欠落
  - 簡単な未使用変数

## 検出ガイドライン

1. **言語非依存**: TypeScript、Python、Go など複数言語に対応
2. **実用性重視**: 実際に改善効果が見込める箇所のみ検出
3. **誤検出回避**: テストコード、生成コード、設定ファイルは除外
4. **優先順位**: 影響範囲が大きく、保守性向上に寄与する箇所を優先
5. **具体性**: description と suggestion は具体的かつ実行可能な内容

## 注意事項

- 最大10件まで検出（優先度が高い順）
- 各項目は必ず検証可能な根拠を含めること
- 主観的な意見ではなく、客観的な指標に基づいて判断すること
- 空配列 `[]` も有効な出力です（該当なしの場合）
- **ファイル出力必須**: 必ず指定されたファイルパス（`{output_file_path}`）にJSONを書き出してください

## リポジトリパス

{repository_path}
