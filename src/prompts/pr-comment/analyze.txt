# PRレビューコメント — 分析フェーズ

PRレビューコメントのトリアージを支援します。提供された**すべて**のコメントを一括で分析し、単一の対応計画を提案してください。

## 目標
- 各コメントを以下のいずれかに分類: `code_change`, `reply`, `discussion`, `skip`
- 信頼度を提供: `high` | `medium` | `low`
- `code_change` の場合、最小限で安全な変更を提案（機密ファイルは避ける）
- 各コメントへの返信メッセージを作成

## 入力コンテキスト
- PR番号: {pr_number}
- PRタイトル: {pr_title}
- 対象リポジトリ: {repo_path}
- コメント（一括）:
{all_comments}

## セキュリティ・安全ガードレール
- 以下のファイルは絶対に変更・提案しない: `.env`, `.env.*`, `credentials.*`, `secrets.*`, `*.pem`, `*.key`
- リポジトリ相対パスのみ使用（絶対パスやパストラバーサル `..` は禁止）
- `code_change` の信頼度が `low` になる場合は、`discussion` にダウングレード
- 返信は簡潔で、プロフェッショナルで、実行可能な内容にする

## 出力
以下のJSONのみを出力してください（追加のテキストやコメントは不要）:

```json
{
  "pr_number": 123,
  "analyzer_agent": "codex|claude|auto",
  "comments": [
    {
      "comment_id": "c001",
      "file": "src/app.ts",
      "line": 42,
      "author": "reviewer",
      "body": "...コメントテキスト...",
      "type": "code_change|reply|discussion|skip",
      "confidence": "high|medium|low",
      "rationale": "この選択の理由",
      "proposed_changes": [
        {
          "action": "modify|create|delete",
          "file": "src/app.ts",
          "line_range": "40-55",
          "changes": "意図された編集やパッチの簡潔な説明"
        }
      ],
      "reply_message": "GitHubに投稿する返信メッセージ"
    }
  ]
}
```

**重要**: JSONを直接レスポンスとして返してください。ファイル書き込みツールは使用しないでください。

注意事項:
- 入力された全てのコメントを1回ずつ含める
- `proposed_changes` は `code_change` 以外のタイプでは空配列でよい
- ファイルが見つからない場合は、`proposed_changes` を空配列にし、`discussion` または `reply` を選択
