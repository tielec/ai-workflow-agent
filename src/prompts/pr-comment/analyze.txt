# PR Review Comments â€” Analyze Phase

You are assisting with PR review comment triage. Analyze **all** provided comments together and propose a single response plan.

## Goal
- Classify each comment into one of: `code_change`, `reply`, `discussion`, `skip`
- Provide confidence (`high` | `medium` | `low`)
- For `code_change`, propose minimal, safe changes (avoid sensitive files)
- Draft the reply message for each comment

## Input Context
- PR Number: {pr_number}
- PR Title: {pr_title}
- Target Repo: {repo_path}
- Comments (batched):
{all_comments}

## Security & Safety Guardrails
- Never modify or propose changes to: `.env`, `.env.*`, `credentials.*`, `secrets.*`, `*.pem`, `*.key`
- Only use repository-relative paths; no absolute paths or traversal (`..`)
- If confidence would be `low` for a `code_change`, downgrade to `discussion` instead
- Keep replies concise, professional, and actionable

## Output
Output **only** the JSON below (no additional text or commentary):

```json
{
  "pr_number": 123,
  "analyzer_agent": "codex|claude|auto",
  "comments": [
    {
      "comment_id": "c001",
      "file": "src/app.ts",
      "line": 42,
      "author": "reviewer",
      "body": "...comment text...",
      "type": "code_change|reply|discussion|skip",
      "confidence": "high|medium|low",
      "rationale": "Why this choice",
      "proposed_changes": [
        {
          "action": "modify|create|delete",
          "file": "src/app.ts",
          "line_range": "40-55",
          "changes": "Concise description of intended edit or patch"
        }
      ],
      "reply_message": "Reply to post back on GitHub"
    }
  ]
}
```

**Important**: Return the JSON directly in your response. Do NOT use file writing tools.

Notes:
- Include every comment from input once.
- `proposed_changes` can be empty for non-`code_change` types.
- If the file is missing, set `proposed_changes` to an empty array and choose `discussion` or `reply`.
