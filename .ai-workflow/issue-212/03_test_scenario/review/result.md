I'll review the test scenario document for Issue #212 by examining the test-scenario.md, design.md, and requirements.md files. Let me first locate and read the planning document to perform the mandatory checklist verification.
Now I'll perform the comprehensive review of the test scenario document. Let me analyze the test scenarios against the planning phase checklist and quality gates.

## 品質ゲート評価

**⚠️ 重要: 各項目に対して明示的にPASS/FAILを判定してください。1つでもFAILがあれば最終判定は自動的にFAILです。**

- [x] **Phase 2の戦略に沿ったテストシナリオである**: **PASS** - テスト戦略「UNIT_INTEGRATION」に完全に沿っている。ユニットテスト（22テストケース）とインテグレーションテスト（9シナリオ）が明確に分離されており、BDDテストは含まれていない（開発者向けCLIコマンドのため不要）。
- [x] **主要な正常系がカバーされている**: **PASS** - 基本的なクリーンアップ（FR-1）、ドライランモード（FR-2）、フェーズ範囲指定（FR-3）、完全クリーンアップ（FR-4）、Report Phase互換性（FR-6）が網羅されている。
- [x] **主要な異常系がカバーされている**: **PASS** - Issue番号未指定・非数値、ワークフロー不存在、無効なフェーズ範囲、Evaluation未完了時の--all指定、パストラバーサル攻撃、シンボリックリンク攻撃がカバーされている。
- [x] **期待結果が明確である**: **PASS** - すべてのテストケースで具体的な期待結果、エラーメッセージ、ファイルシステム状態、Git操作結果が明確に記載されており、検証可能な確認項目チェックリストが用意されている。

**品質ゲート総合判定: PASS**
- PASS: 上記4項目すべてがPASS

## Planning Phase チェックリスト照合

Phase 3のタスクと照合した結果：

### Task 3-1: ユニットテストシナリオ作成 ✅

テストシナリオに以下が含まれており、**完了**と判定：
- CLI引数解析ロジックのテストケース: `validateCleanupOptions()`, `parsePhaseRange()`のテストケースが網羅されている（正常系12個、異常系10個）
- バリデーション関数のテストケース（正常系・異常系）: セクション2.1〜2.4で詳細に記載
- ドライランモードのテストケース: セクション2.6で記載

### Task 3-2: インテグレーションテストシナリオ作成 ✅

テストシナリオに以下が含まれており、**完了**と判定：
- `cleanup --issue <NUM>`の実行テスト: セクション3.1で記載
- `cleanup --issue <NUM> --dry-run`の実行テスト: セクション3.2で記載
- `cleanup --issue <NUM> --phases 0-4`の実行テスト: セクション3.3, 3.4で記載
- `cleanup --issue <NUM> --all`の実行テスト（Evaluation Phase完了前後）: セクション3.5, 3.6, 3.7で記載

すべてのタスクが完了しているため、planning.mdを更新します。
Let me use replace_all to update both occurrences in the planning document:
Perfect! Now let me provide the comprehensive review of the test scenario document:

## 詳細レビュー

### 1. テスト戦略との整合性

**良好な点**:
- テストシナリオは**UNIT_INTEGRATION**戦略に完全に沿っている
- ユニットテスト（セクション2.1〜2.6）とインテグレーションテスト（セクション3.1〜3.9）が明確に分離されている
- BDDテストが含まれておらず、Phase 2で決定された方針（開発者向けCLIコマンドのためBDD不要）と一致
- Planning Phaseで定義された内容（ユニットテスト: CLI引数解析、バリデーション、ドライラン / インテグレーション: ファイルシステム操作、Git統合、Report Phase互換性）が完全にカバーされている

**懸念点**:
- なし

### 2. 正常系のカバレッジ

**良好な点**:
- 要件定義書の全主要機能要件がカバーされている
  - FR-1（基本的なクリーンアップ）: セクション2.1, 3.1でカバー
  - FR-2（ドライランモード）: セクション2.6, 3.2でカバー
  - FR-3（部分クリーンアップ）: セクション2.3, 3.3, 3.4でカバー
  - FR-4（完全クリーンアップ）: セクション2.1（行97-117）, 3.5, 3.6でカバー
  - FR-6（Report Phase互換性）: セクション3.8でカバー
- クリティカルパスが明確に定義されている（基本的なクリーンアップ → Git操作 → 成功メッセージ）
- テストデータ（metadata.json、ディレクトリ構造）が具体的に定義されている（セクション4）

**改善の余地**:
- なし（主要な正常系はすべてカバーされている）

### 3. 異常系のカバレッジ

**良好な点**:
- 主要なエラーケースが網羅されている
  - Issue番号バリデーション（未指定、非数値、ワークフロー不存在）: セクション2.2で8個のテストケース
  - フェーズ範囲バリデーション（範囲外、逆順、無効な形式、空文字列）: セクション2.4で5個のテストケース
  - Evaluation未完了時の--all指定: セクション2.2（行183-204）、3.7
  - セキュリティ（パストラバーサル、シンボリックリンク）: セクション3.9で2つのシナリオ
- エラーメッセージが具体的に定義されており、検証可能
- 境界値テスト（大量ファイル: 1000ファイル、警告閾値: 1001ファイル）が含まれている（セクション4.3）

**改善の余地**:
- `--phases`と`--all`の同時指定エラー（セクション2.2、行206-216）: インテグレーションテストにも追加すると、より実践的なテストになる（ただし、ユニットテストで十分カバーされているため、ブロッカーではない）

### 4. 期待結果の明確性

**良好な点**:
- すべてのテストケースで具体的な期待結果が記載されている
- エラーメッセージが完全に記載されている（例: `Error: Invalid phase range: 10-12. Valid range is 0-9`）
- ファイルシステム状態が明確に定義されている（削除されるディレクトリ、保持されるファイル）
- Git操作結果が具体的に記載されている（コミットメッセージ、プッシュ確認）
- インテグレーションテストに検証可能な確認項目チェックリストがある（セクション3.1〜3.8）
- 終了コードが明記されている（異常系は終了コード1）

**懸念点**:
- なし

### 5. 要件との対応

**良好な点**:
- 要件定義書の受け入れ基準（AC-1〜AC-10）がすべてテストシナリオに反映されている
  - AC-1（基本的なクリーンアップ）→ セクション3.1
  - AC-2（ドライラン）→ セクション3.2
  - AC-3, AC-4（部分クリーンアップ）→ セクション3.3, 3.4
  - AC-5, AC-6（完全クリーンアップ）→ セクション3.5, 3.7
  - AC-7, AC-8（エラーハンドリング）→ セクション3.7
  - AC-9（Report Phase互換性）→ セクション3.8
  - AC-10（CI環境での自動承認）→ セクション3.6
- 機能要件（FR-1〜FR-6）がすべてテスト対象に含まれている
- 非機能要件（NFR-1: パフォーマンス、NFR-2: セキュリティ、NFR-3: 信頼性）がテストシナリオに反映されている

**改善の余地**:
- なし

### 6. 実行可能性

**良好な点**:
- テストシナリオは実装・実行可能
- テストデータが具体的に定義されている（metadata.json、ディレクトリ構造、ファイルサイズ）
- 前提条件が明確（テスト用リポジトリ、Gitリモート、環境変数）
- テスト環境要件が詳細に記載されている（セクション5: OS、Node.js、Git、CI/CD環境）
- モック/スタブの使用方針が明確（ユニットテスト: モック化、インテグレーションテスト: 実ファイルシステム使用）
- テストカバレッジ目標が具体的（ユニットテスト90%以上）

**懸念点**:
- なし

## ブロッカー（BLOCKER）

**次フェーズに進めない重大な問題**

なし

## 改善提案（SUGGESTION）

**次フェーズに進めるが、改善が望ましい事項**

1. **インテグレーションテスト: `--phases`と`--all`の同時指定エラーのシナリオ追加**
   - 現状: ユニットテスト（セクション2.2）でのみカバーされている
   - 提案: セクション3.7（エラーハンドリング）に以下のシナリオを追加すると、より実践的なテストになる
     ```
     シナリオ名: --phasesと--allの同時指定エラー
     - 前提条件: Issue #123のワークフローが存在する
     - コマンド実行: `node dist/index.js cleanup --issue 123 --phases 0-4 --all`
     - 期待結果: `Error: Cannot specify both --phases and --all options`
     ```
   - 効果: エンドツーエンドでのCLI引数バリデーションを確認できる

2. **パフォーマンステスト: 削除時間の測定シナリオ**
   - 現状: 境界値データ（1000ファイル、10秒以内）が定義されている（セクション4.3）が、実際の測定シナリオがない
   - 提案: セクション3.1（基本的なクリーンアップ）または新規セクション3.10に以下を追加すると、非機能要件（NFR-1）を確実に検証できる
     ```
     シナリオ名: 大量ファイル削除時のパフォーマンス確認
     - 前提条件: 1000ファイル（合計100MB）が存在する
     - 期待結果: 削除が10秒以内に完了する
     ```
   - 効果: パフォーマンス要件を定量的に検証できる

3. **テストデータ: 異常データの充実**
   - 現状: 正常データが充実しているが、異常データ（セクション4.2）は最小限
   - 提案: 以下を追加すると、エッジケースのテストがより堅牢になる
     - Issue番号が負の数の場合の`metadata.json`
     - フェーズステータスが不正な値（例: `status: "invalid"`）の場合の`metadata.json`
   - 効果: 異常系テストの実装が容易になる

## 総合評価

本テストシナリオは、Issue #212「ワークフローログクリーンアップを独立したコマンドとして実装する」について、非常に高品質かつ包括的な内容となっています。

**主な強み**:
- **テスト戦略との完全な整合性**: UNIT_INTEGRATION戦略に完全に沿っており、22個のユニットテストケースと9個のインテグレーションシナリオが明確に定義されている
- **網羅的なカバレッジ**: 要件定義書の全受け入れ基準（AC-1〜AC-10）、全機能要件（FR-1〜FR-6）がカバーされている
- **明確な期待結果**: すべてのテストケースで検証可能な期待結果、エラーメッセージ、確認項目チェックリストが用意されている
- **実行可能性**: テストデータ、前提条件、環境要件が具体的に定義されており、即座に実装可能
- **セキュリティ考慮**: パストラバーサル攻撃、シンボリックリンク攻撃のテストシナリオが含まれている
- **Planning Phaseとの整合性**: Phase 3のすべてのタスク（Task 3-1, 3-2）が完了しており、品質ゲートを満たしている

**主な改善提案**:
- `--phases`と`--all`同時指定エラーのインテグレーションテスト追加（優先度: 低、ユニットテストで十分カバーされている）
- パフォーマンステストの測定シナリオ追加（優先度: 低、境界値データが定義されているため実装フェーズで対応可能）
- 異常データの充実（優先度: 低、主要な異常系は十分カバーされている）

本テストシナリオは、次フェーズ（Phase 4: Implementation）に進むための十分な品質を満たしています。改善提案はいずれも「あればより良い」レベルであり、現状のままでも実装に支障はありません。Planning Phaseのチェックリストもすべて完了しており、プロジェクトは順調に進行しています。

---
**判定: PASS**
Perfect! Now let me provide the comprehensive review of the test scenario document:

## 詳細レビュー

### 1. テスト戦略との整合性

**良好な点**:
- テストシナリオは**UNIT_INTEGRATION**戦略に完全に沿っている
- ユニットテスト（セクション2.1〜2.6）とインテグレーションテスト（セクション3.1〜3.9）が明確に分離されている
- BDDテストが含まれておらず、Phase 2で決定された方針（開発者向けCLIコマンドのためBDD不要）と一致
- Planning Phaseで定義された内容（ユニットテスト: CLI引数解析、バリデーション、ドライラン / インテグレーション: ファイルシステム操作、Git統合、Report Phase互換性）が完全にカバーされている

**懸念点**:
- なし

### 2. 正常系のカバレッジ

**良好な点**:
- 要件定義書の全主要機能要件がカバーされている
  - FR-1（基本的なクリーンアップ）: セクション2.1, 3.1でカバー
  - FR-2（ドライランモード）: セクション2.6, 3.2でカバー
  - FR-3（部分クリーンアップ）: セクション2.3, 3.3, 3.4でカバー
  - FR-4（完全クリーンアップ）: セクション2.1（行97-117）, 3.5, 3.6でカバー
  - FR-6（Report Phase互換性）: セクション3.8でカバー
- クリティカルパスが明確に定義されている（基本的なクリーンアップ → Git操作 → 成功メッセージ）
- テストデータ（metadata.json、ディレクトリ構造）が具体的に定義されている（セクション4）

**改善の余地**:
- なし（主要な正常系はすべてカバーされている）

### 3. 異常系のカバレッジ

**良好な点**:
- 主要なエラーケースが網羅されている
  - Issue番号バリデーション（未指定、非数値、ワークフロー不存在）: セクション2.2で8個のテストケース
  - フェーズ範囲バリデーション（範囲外、逆順、無効な形式、空文字列）: セクション2.4で5個のテストケース
  - Evaluation未完了時の--all指定: セクション2.2（行183-204）、3.7
  - セキュリティ（パストラバーサル、シンボリックリンク）: セクション3.9で2つのシナリオ
- エラーメッセージが具体的に定義されており、検証可能
- 境界値テスト（大量ファイル: 1000ファイル、警告閾値: 1001ファイル）が含まれている（セクション4.3）

**改善の余地**:
- `--phases`と`--all`の同時指定エラー（セクション2.2、行206-216）: インテグレーションテストにも追加すると、より実践的なテストになる（ただし、ユニットテストで十分カバーされているため、ブロッカーではない）

### 4. 期待結果の明確性

**良好な点**:
- すべてのテストケースで具体的な期待結果が記載されている
- エラーメッセージが完全に記載されている（例: `Error: Invalid phase range: 10-12. Valid range is 0-9`）
- ファイルシステム状態が明確に定義されている（削除されるディレクトリ、保持されるファイル）
- Git操作結果が具体的に記載されている（コミットメッセージ、プッシュ確認）
- インテグレーションテストに検証可能な確認項目チェックリストがある（セクション3.1〜3.8）
- 終了コードが明記されている（異常系は終了コード1）

**懸念点**:
- なし

### 5. 要件との対応

**良好な点**:
- 要件定義書の受け入れ基準（AC-1〜AC-10）がすべてテストシナリオに反映されている
  - AC-1（基本的なクリーンアップ）→ セクション3.1
  - AC-2（ドライラン）→ セクション3.2
  - AC-3, AC-4（部分クリーンアップ）→ セクション3.3, 3.4
  - AC-5, AC-6（完全クリーンアップ）→ セクション3.5, 3.7
  - AC-7, AC-8（エラーハンドリング）→ セクション3.7
  - AC-9（Report Phase互換性）→ セクション3.8
  - AC-10（CI環境での自動承認）→ セクション3.6
- 機能要件（FR-1〜FR-6）がすべてテスト対象に含まれている
- 非機能要件（NFR-1: パフォーマンス、NFR-2: セキュリティ、NFR-3: 信頼性）がテストシナリオに反映されている

**改善の余地**:
- なし

### 6. 実行可能性

**良好な点**:
- テストシナリオは実装・実行可能
- テストデータが具体的に定義されている（metadata.json、ディレクトリ構造、ファイルサイズ）
- 前提条件が明確（テスト用リポジトリ、Gitリモート、環境変数）
- テスト環境要件が詳細に記載されている（セクション5: OS、Node.js、Git、CI/CD環境）
- モック/スタブの使用方針が明確（ユニットテスト: モック化、インテグレーションテスト: 実ファイルシステム使用）
- テストカバレッジ目標が具体的（ユニットテスト90%以上）

**懸念点**:
- なし

## ブロッカー（BLOCKER）

**次フェーズに進めない重大な問題**

なし

## 改善提案（SUGGESTION）

**次フェーズに進めるが、改善が望ましい事項**

1. **インテグレーションテスト: `--phases`と`--all`の同時指定エラーのシナリオ追加**
   - 現状: ユニットテスト（セクション2.2）でのみカバーされている
   - 提案: セクション3.7（エラーハンドリング）に以下のシナリオを追加すると、より実践的なテストになる
     ```
     シナリオ名: --phasesと--allの同時指定エラー
     - 前提条件: Issue #123のワークフローが存在する
     - コマンド実行: `node dist/index.js cleanup --issue 123 --phases 0-4 --all`
     - 期待結果: `Error: Cannot specify both --phases and --all options`
     ```
   - 効果: エンドツーエンドでのCLI引数バリデーションを確認できる

2. **パフォーマンステスト: 削除時間の測定シナリオ**
   - 現状: 境界値データ（1000ファイル、10秒以内）が定義されている（セクション4.3）が、実際の測定シナリオがない
   - 提案: セクション3.1（基本的なクリーンアップ）または新規セクション3.10に以下を追加すると、非機能要件（NFR-1）を確実に検証できる
     ```
     シナリオ名: 大量ファイル削除時のパフォーマンス確認
     - 前提条件: 1000ファイル（合計100MB）が存在する
     - 期待結果: 削除が10秒以内に完了する
     ```
   - 効果: パフォーマンス要件を定量的に検証できる

3. **テストデータ: 異常データの充実**
   - 現状: 正常データが充実しているが、異常データ（セクション4.2）は最小限
   - 提案: 以下を追加すると、エッジケースのテストがより堅牢になる
     - Issue番号が負の数の場合の`metadata.json`
     - フェーズステータスが不正な値（例: `status: "invalid"`）の場合の`metadata.json`
   - 効果: 異常系テストの実装が容易になる

## 総合評価

本テストシナリオは、Issue #212「ワークフローログクリーンアップを独立したコマンドとして実装する」について、非常に高品質かつ包括的な内容となっています。

**主な強み**:
- **テスト戦略との完全な整合性**: UNIT_INTEGRATION戦略に完全に沿っており、22個のユニットテストケースと9個のインテグレーションシナリオが明確に定義されている
- **網羅的なカバレッジ**: 要件定義書の全受け入れ基準（AC-1〜AC-10）、全機能要件（FR-1〜FR-6）がカバーされている
- **明確な期待結果**: すべてのテストケースで検証可能な期待結果、エラーメッセージ、確認項目チェックリストが用意されている
- **実行可能性**: テストデータ、前提条件、環境要件が具体的に定義されており、即座に実装可能
- **セキュリティ考慮**: パストラバーサル攻撃、シンボリックリンク攻撃のテストシナリオが含まれている
- **Planning Phaseとの整合性**: Phase 3のすべてのタスク（Task 3-1, 3-2）が完了しており、品質ゲートを満たしている

**主な改善提案**:
- `--phases`と`--all`同時指定エラーのインテグレーションテスト追加（優先度: 低、ユニットテストで十分カバーされている）
- パフォーマンステストの測定シナリオ追加（優先度: 低、境界値データが定義されているため実装フェーズで対応可能）
- 異常データの充実（優先度: 低、主要な異常系は十分カバーされている）

本テストシナリオは、次フェーズ（Phase 4: Implementation）に進むための十分な品質を満たしています。改善提案はいずれも「あればより良い」レベルであり、現状のままでも実装に支障はありません。Planning Phaseのチェックリストもすべて完了しており、プロジェクトは順調に進行しています。

---
**判定: PASS**