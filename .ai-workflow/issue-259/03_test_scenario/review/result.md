I'll review the test scenario document for Issue #259 using critical thinking and the quality gates defined in the review prompt.
Now I'll conduct a comprehensive review of the test scenario document and update the planning.md checklist.

## 品質ゲート評価

**⚠️ 重要: 各項目に対して明示的にPASS/FAILを判定してください。1つでもFAILがあれば最終判定は自動的にFAILです。**

- [x] **Phase 2の戦略に沿ったテストシナリオである**: **PASS** - テスト戦略「INTEGRATION_ONLY」に完全に沿っており、Jenkins環境での統合テストシナリオのみが記載されている。Unitテスト・BDDシナリオは含まれておらず、戦略と100%整合している。
- [x] **主要な正常系がカバーされている**: **PASS** - シードジョブからのジョブ作成、パラメータバリデーション、Cleanup Workflowステージ（ドライラン/通常モード/フェーズ名リスト/完全クリーンアップ）、共通処理モジュール統合、エンドツーエンドテストなど、主要な正常系が20シナリオで網羅的にカバーされている。
- [x] **主要な異常系がカバーされている**: **PASS** - 必須パラメータ未指定、不正なISSUE_URL形式、CLEANUP_PHASESとCLEANUP_ALLの同時指定、不正なCLEANUP_PHASES形式、Evaluation未完了での--all指定など、主要な異常系が5シナリオでカバーされている。
- [x] **期待結果が明確である**: **PASS** - 全20シナリオで「期待結果」セクションがあり、各シナリオに「確認項目」チェックリストが付いており、成功/失敗の判定基準が明確に記載されている。

**品質ゲート総合判定: PASS**
- PASS: 上記4項目すべてがPASS

## 詳細レビュー

### 1. テスト戦略との整合性

**良好な点**:
- テスト戦略「INTEGRATION_ONLY」に完全に準拠している
- Jenkins環境での統合テストシナリオのみが記載されており、Groovyコードの単体テストやBDDシナリオは含まれていない
- 既存のcleanupコマンド（Issue #212）のテストは別途実装済みという前提を踏まえている
- 手動実行による統合テストという方針が明確に反映されている

**懸念点**:
- なし

### 2. 正常系のカバレッジ

**良好な点**:
- **シードジョブからのジョブ作成**（シナリオ2.1）: 10フォルダへのジョブ作成、パラメータ定義、Job DSL構文検証を網羅
- **パラメータバリデーション**（シナリオ2.2）: 正常なパラメータでの実行を検証
- **Cleanup Workflowステージ**の複数パターン:
  - ドライランモード（シナリオ2.7）
  - 通常モード - フェーズ範囲指定（シナリオ2.8）
  - 通常モード - フェーズ名リスト指定（シナリオ2.9）
  - 完全クリーンアップ - CLEANUP_ALL（シナリオ2.10）
- **共通処理モジュール統合**（シナリオ2.13-2.17）: Load Common Library、Prepare Agent Credentials、Setup Environment、Setup Node.js Environment、Archive Artifactsの5つの統合を個別に検証
- **TODOステージ**（シナリオ2.12）: Squash Commits、Update PR、Promote PRのスキップ動作を確認
- **エンドツーエンドテスト**:
  - ドライランモード（シナリオ2.18）
  - 通常モード（シナリオ2.19）
- **複数フォルダでのジョブ実行**（シナリオ2.20）: develop、stable-1、stable-5の3フォルダで動作確認

**改善の余地**:
- なし（主要な正常系は十分カバーされている）

### 3. 異常系のカバレッジ

**良好な点**:
- **必須パラメータ未指定**（シナリオ2.3）: ISSUE_URLが空欄の場合のエラーハンドリング
- **不正なISSUE_URL形式**（シナリオ2.4）:
  - GitHubでないURL（GitLab等）
  - Issue URLでない（Pull Request等）
- **CLEANUP_PHASESとCLEANUP_ALLの同時指定**（シナリオ2.5）: 排他チェックの検証
- **不正なCLEANUP_PHASES形式**（シナリオ2.6）:
  - 不正な形式（invalid-format）
  - 範囲外の数値（0-10）
- **Evaluation未完了での--all指定**（シナリオ2.11）: Phase 9未完了時の--allオプションエラー

**改善の余地**:
- **境界値テスト**は軽く触れられているが（3.2節の「境界値データ」）、明示的なシナリオは少ない
  - 提案: Phase範囲の境界値（0-0、9-9、0-9）のテストシナリオを追加するとより網羅的
  - ただし、これは「80点で十分」の原則に照らせば必須ではない

### 4. 期待結果の明確性

**良好な点**:
- 全20シナリオで「期待結果」セクションが明記されている
- 各シナリオに「確認項目」チェックリストがあり、具体的な検証ポイントが列挙されている
- 成功/失敗の判定基準が明確（例: 「ステータス: SUCCESS」「エラーメッセージ: "..."」）
- 出力メッセージ、ビルドディスクリプション、Git操作結果、ファイルシステム状態など、検証可能な形で記述されている
- 曖昧な表現がなく、テスト実行者が迷わない記述

**懸念点**:
- なし

### 5. 要件との対応

**良好な点**:
- **受け入れ基準との対応表**（7節）で要件定義書の受け入れ基準との対応が明記されている
- AC-1～AC-8の受け入れ基準がすべてテストシナリオにマッピングされている:
  - AC-1: Jenkinsfileの作成 → シナリオ2.1, 2.18, 2.19
  - AC-2: Job DSLの作成 → シナリオ2.1
  - AC-3: シードジョブへの統合 → シナリオ2.1
  - AC-4: Cleanup Workflowステージの動作確認 → シナリオ2.7, 2.8, 2.9, 2.10
  - AC-5: ドライランモードの動作確認 → シナリオ2.7, 2.18
  - AC-6: パラメータバリデーション → シナリオ2.2, 2.3, 2.4, 2.5, 2.6
  - AC-7: 共通処理モジュールの活用 → シナリオ2.13-2.17
  - AC-8: TODOステージのプレースホルダー → シナリオ2.12
- **汎用フォルダ構成**（develop + stable-1～9）への対応もシナリオ2.1, 2.20で検証されている

**改善の余地**:
- なし（要件との対応は完璧）

### 6. 実行可能性

**良好な点**:
- **前提条件**が各シナリオで明記されており、テスト実行前に準備すべき内容が明確
- **テストデータ**（3節）で具体的なパラメータ値が定義されている:
  - 正常データ: Issue #259、CLEANUP_PHASES: 0-8/0-4/planning,requirements等
  - 異常データ: 空欄、GitLab URL、Pull Request URL等
  - 境界値データ: 0-0、9-9、0-9等
- **テスト環境要件**（4節）で必要なJenkins環境、外部サービス、認証情報、ファイルシステムが明記されている
- **テスト実行ガイドライン**（8節）で推奨実行順序、テスト準備、テスト後のクリーンアップが詳細に記載されている
- **トラブルシューティング**（9節）で想定される問題と対処法が記載されている
- **テスト結果レポートテンプレート**（10節）でテスト結果の記録方法が明確

**懸念点**:
- なし

## Planning.mdチェックリスト照合結果
**Planning.mdチェックリスト照合結果: PASS**

Phase 3のタスク3.1「統合テストシナリオ作成」のすべてのサブタスクが完了していることを確認しました：
- [x] シードジョブからのジョブ作成テスト → シナリオ2.1で実装
- [x] 正常系テストケース（各パラメータパターン） → シナリオ2.2, 2.7-2.10, 2.13-2.20で実装
- [x] 異常系テストケース（必須パラメータ未指定、不正なフェーズ範囲等） → シナリオ2.3-2.6, 2.11で実装
- [x] ドライランモードテスト → シナリオ2.7, 2.18で実装

planning.mdのチェックボックスを更新しました。

## ブロッカー（BLOCKER）

**次フェーズに進めない重大な問題**

なし

## 改善提案（SUGGESTION）

**次フェーズに進めるが、改善が望ましい事項**

1. **境界値テストの明示的なシナリオ追加**
   - 現状: 3.2節「境界値データ」でCLEANUP_PHASES: 0-0、9-9、0-9等が定義されているが、明示的なテストシナリオとして実装されていない
   - 提案: シナリオ2.6「パラメータバリデーション（異常系 - 不正なCLEANUP_PHASES形式）」にケース3として境界値テストを追加
   - 効果: エッジケースのカバレッジがさらに向上し、Phase範囲のバリデーション動作がより確実になる
   - **判断**: 現状でも主要なエッジケースはカバーされており、次フェーズに進む上でブロッカーではない

2. **パフォーマンステストシナリオの追加**
   - 現状: 設計書（7節 非機能要件 NFR-1）で「3分以内にクリーンアップ完了」という要件があるが、明示的なパフォーマンステストシナリオはない
   - 提案: シナリオ2.21として「パフォーマンステスト（実行時間計測）」を追加
   - 効果: NFR-1の受け入れ基準を明示的に検証できる
   - **判断**: 統合テスト実行時に実行時間を記録すれば十分であり、独立したシナリオとして必須ではない

3. **セキュリティテストシナリオの追加**
   - 現状: 設計書（8節 セキュリティ考慮事項）でAPIキーのマスキング、シークレット情報の成果物アーカイブ等が記載されているが、セキュリティ観点のテストシナリオは明示的に含まれていない
   - 提案: シナリオ2.22として「セキュリティテスト（APIキーマスキング、シークレットスキャン）」を追加
   - 効果: NFR-4（セキュリティ）の受け入れ基準を明示的に検証できる
   - **判断**: これらのセキュリティ対策は既存の共通処理（common.groovy、Issue #54のSecretMasker）で実装済みであり、統合テストで既存機能として動作確認すれば十分

## 総合評価

**主な強み**:
- **テスト戦略との完全な整合性**: INTEGRATION_ONLYという戦略に100%沿っており、Jenkins環境での統合テストシナリオのみが記載されている
- **網羅的なシナリオカバレッジ**: 20個のシナリオで正常系・異常系・エンドツーエンドを網羅
- **明確な期待結果**: 全シナリオで「期待結果」と「確認項目」チェックリストがあり、検証可能な形で記述されている
- **要件との完璧な対応**: 受け入れ基準AC-1～AC-8がすべてテストシナリオにマッピングされている
- **実行可能性の高さ**: 前提条件、テストデータ、環境要件、実行ガイドライン、トラブルシューティングが詳細に記載されており、実際にテストを実行できる状態
- **品質ゲート確認**: 6.9節で品質ゲート（Phase 3）が明記されており、すべて満たされている

**主な改善提案**:
- 境界値テストの明示的なシナリオ追加（任意）
- パフォーマンステストシナリオの追加（任意）
- セキュリティテストシナリオの追加（任意）

このテストシナリオは「80点で十分」の原則に照らして、**80点どころか95点以上**の品質を達成しています。主要な正常系・異常系が網羅され、期待結果が明確で、要件との対応も完璧です。改善提案はすべて「あればより良い」レベルであり、次フェーズ（実装）に進む上で十分な品質を満たしています。

**総括コメント**:

このテストシナリオは、INTEGRATION_ONLYというテスト戦略を完璧に実現しており、Jenkins環境での統合テストを実施するための詳細かつ実行可能なシナリオが20個定義されています。設計書・要件定義書との整合性も完璧で、受け入れ基準AC-1～AC-8がすべてテストシナリオにマッピングされています。

特に優れている点は、**各シナリオの期待結果と確認項目が具体的かつ検証可能な形で記述されている**ことです。テスト実行者が迷うことなく、明確な判定基準でPASS/FAILを判断できます。

改善提案として3点挙げましたが、いずれも「次フェーズに進む上で必須ではない」レベルのものであり、現状のテストシナリオで実装フェーズに進むことに何ら問題はありません。

**次フェーズ（実装）に進む準備が完全に整っています。**

---
**判定: PASS**
**Planning.mdチェックリスト照合結果: PASS**

Phase 3のタスク3.1「統合テストシナリオ作成」のすべてのサブタスクが完了していることを確認しました：
- [x] シードジョブからのジョブ作成テスト → シナリオ2.1で実装
- [x] 正常系テストケース（各パラメータパターン） → シナリオ2.2, 2.7-2.10, 2.13-2.20で実装
- [x] 異常系テストケース（必須パラメータ未指定、不正なフェーズ範囲等） → シナリオ2.3-2.6, 2.11で実装
- [x] ドライランモードテスト → シナリオ2.7, 2.18で実装

planning.mdのチェックボックスを更新しました。

## ブロッカー（BLOCKER）

**次フェーズに進めない重大な問題**

なし

## 改善提案（SUGGESTION）

**次フェーズに進めるが、改善が望ましい事項**

1. **境界値テストの明示的なシナリオ追加**
   - 現状: 3.2節「境界値データ」でCLEANUP_PHASES: 0-0、9-9、0-9等が定義されているが、明示的なテストシナリオとして実装されていない
   - 提案: シナリオ2.6「パラメータバリデーション（異常系 - 不正なCLEANUP_PHASES形式）」にケース3として境界値テストを追加
   - 効果: エッジケースのカバレッジがさらに向上し、Phase範囲のバリデーション動作がより確実になる
   - **判断**: 現状でも主要なエッジケースはカバーされており、次フェーズに進む上でブロッカーではない

2. **パフォーマンステストシナリオの追加**
   - 現状: 設計書（7節 非機能要件 NFR-1）で「3分以内にクリーンアップ完了」という要件があるが、明示的なパフォーマンステストシナリオはない
   - 提案: シナリオ2.21として「パフォーマンステスト（実行時間計測）」を追加
   - 効果: NFR-1の受け入れ基準を明示的に検証できる
   - **判断**: 統合テスト実行時に実行時間を記録すれば十分であり、独立したシナリオとして必須ではない

3. **セキュリティテストシナリオの追加**
   - 現状: 設計書（8節 セキュリティ考慮事項）でAPIキーのマスキング、シークレット情報の成果物アーカイブ等が記載されているが、セキュリティ観点のテストシナリオは明示的に含まれていない
   - 提案: シナリオ2.22として「セキュリティテスト（APIキーマスキング、シークレットスキャン）」を追加
   - 効果: NFR-4（セキュリティ）の受け入れ基準を明示的に検証できる
   - **判断**: これらのセキュリティ対策は既存の共通処理（common.groovy、Issue #54のSecretMasker）で実装済みであり、統合テストで既存機能として動作確認すれば十分

## 総合評価

**主な強み**:
- **テスト戦略との完全な整合性**: INTEGRATION_ONLYという戦略に100%沿っており、Jenkins環境での統合テストシナリオのみが記載されている
- **網羅的なシナリオカバレッジ**: 20個のシナリオで正常系・異常系・エンドツーエンドを網羅
- **明確な期待結果**: 全シナリオで「期待結果」と「確認項目」チェックリストがあり、検証可能な形で記述されている
- **要件との完璧な対応**: 受け入れ基準AC-1～AC-8がすべてテストシナリオにマッピングされている
- **実行可能性の高さ**: 前提条件、テストデータ、環境要件、実行ガイドライン、トラブルシューティングが詳細に記載されており、実際にテストを実行できる状態
- **品質ゲート確認**: 6.9節で品質ゲート（Phase 3）が明記されており、すべて満たされている

**主な改善提案**:
- 境界値テストの明示的なシナリオ追加（任意）
- パフォーマンステストシナリオの追加（任意）
- セキュリティテストシナリオの追加（任意）

このテストシナリオは「80点で十分」の原則に照らして、**80点どころか95点以上**の品質を達成しています。主要な正常系・異常系が網羅され、期待結果が明確で、要件との対応も完璧です。改善提案はすべて「あればより良い」レベルであり、次フェーズ（実装）に進む上で十分な品質を満たしています。

**総括コメント**:

このテストシナリオは、INTEGRATION_ONLYというテスト戦略を完璧に実現しており、Jenkins環境での統合テストを実施するための詳細かつ実行可能なシナリオが20個定義されています。設計書・要件定義書との整合性も完璧で、受け入れ基準AC-1～AC-8がすべてテストシナリオにマッピングされています。

特に優れている点は、**各シナリオの期待結果と確認項目が具体的かつ検証可能な形で記述されている**ことです。テスト実行者が迷うことなく、明確な判定基準でPASS/FAILを判断できます。

改善提案として3点挙げましたが、いずれも「次フェーズに進む上で必須ではない」レベルのものであり、現状のテストシナリオで実装フェーズに進むことに何ら問題はありません。

**次フェーズ（実装）に進む準備が完全に整っています。**

---
**判定: PASS**