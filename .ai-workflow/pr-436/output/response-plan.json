{
  "pr_number": 436,
  "analyzer_agent": "codex",
  "comments": [
    {
      "comment_id": "2616718581",
      "file": "jenkins/jobs/pipeline/ai-workflow/auto-issue/Jenkinsfile",
      "line": 13,
      "author": "yuto-takashi",
      "body": "JobDSL へのパラメータ追加が行われていません。対応してください。",
      "type": "code_change",
      "confidence": "high",
      "rationale": "Jenkinsfile already accepts CUSTOM_INSTRUCTION but the corresponding Job DSL lacks the parameter, so jobs cannot pass the value; adding the textParam aligns the pipeline parameters.",
      "proposed_changes": [
        {
          "action": "modify",
          "file": "jenkins/jobs/dsl/ai-workflow/ai_workflow_auto_issue_job.groovy",
          "line_range": "1-223",
          "changes": "/**\n * AI Workflow Auto Issue Job DSL\n *\n * AIによる自動Issue作成用ジョブ\n * EXECUTION_MODE: auto_issue（固定値、パラメータとして表示しない）\n * パラメータ数: 15個（9個 + APIキー6個）\n */\n\n// 汎用フォルダ定義（Develop 1 + Stable 9）\ndef genericFolders = [\n    [name: 'develop', displayName: 'AI Workflow Executor - Develop', branch: '*/develop']\n] + (1..9).collect { i ->\n    [name: \"stable-${i}\", displayName: \"AI Workflow Executor - Stable ${i}\", branch: '*/main']\n}\n\n// 共通設定を取得\ndef jenkinsPipelineRepo = commonSettings['jenkins-pipeline-repo']\ndef jobKey = 'ai_workflow_auto_issue_job'\ndef jobConfig = jenkinsJobsConfig[jobKey]\n\n// ジョブ作成クロージャ\ndef createJob = { String jobName, String descriptionHeader, String gitBranch ->\n    pipelineJob(jobName) {\n        displayName(jobConfig.displayName)\n\n        description(\"\"\"            |# AI Workflow - Auto Issue Creation\n            |\n            |${descriptionHeader}\n            |\n            |## 概要\n            |AIエージェントがリポジトリを探索し、バグや改善点を検出してIssueを自動作成します。\n            |\n            |## Issue検出カテゴリ\n            |- bug: バグ・潜在的問題の検出（Phase 1で実装済み）\n            |- refactor: リファクタリング候補の検出（Phase 2で実装予定）\n            |- enhancement: 機能拡張提案（Phase 3で実装予定）\n            |- all: 全カテゴリを検出\n            |\n            |## 機能\n            |- 重複判定の類似度閾値設定（デフォルト: 0.8）\n            |- 作成するIssueの最大数設定（デフォルト: 5）\n            |\n            |## 注意事項\n            |- EXECUTION_MODEは内部的に'auto_issue'に固定されます\n            |- ISSUE_URLは不要（リポジトリ探索により自動Issue作成）\n            |- コスト上限: デフォルト $5.00 USD\n            \"\"\".stripMargin())\n\n        // パラメータ定義\n        parameters {\n            // ========================================\n            // 実行モード（固定値）\n            // ========================================\n            choiceParam('EXECUTION_MODE', ['auto_issue'], '''\n実行モード（固定値 - 変更不可）\n            '''.stripIndent().trim())\n\n            // ========================================\n            // 基本設定\n            // ========================================\n            stringParam('GITHUB_REPOSITORY', '', '''\nGitHub リポジトリ（owner/repo）（必須）\n\n例: tielec/ai-workflow-agent\n            '''.stripIndent().trim())\n\n            choiceParam('AGENT_MODE', ['auto', 'codex', 'claude'], '''\nエージェントの実行モード\n- auto: Codex APIキーがあれば Codex を優先し、なければ Claude Code を使用\n- codex: Codex のみを使用（CODEX_API_KEY または OPENAI_API_KEY が必要）\n- claude: Claude Code のみを使用（credentials.json が必要）\n            '''.stripIndent().trim())\n\n            // ========================================\n            // Auto Issue 設定\n            // ========================================\n            choiceParam('AUTO_ISSUE_CATEGORY', ['bug', 'refactor', 'enhancement', 'all'], '''\nIssue検出カテゴリ\n\n- bug: バグ・潜在的問題の検出（Phase 1で実装済み）\n- refactor: リファクタリング候補の検出（Phase 2で実装予定）\n- enhancement: 機能拡張提案（Phase 3で実装予定）\n- all: 全カテゴリを検出\n            '''.stripIndent().trim())\n\n            stringParam('AUTO_ISSUE_LIMIT', '5', '''\n作成するIssueの最大数\n\n1〜50の範囲で指定してください。\n            '''.stripIndent().trim())\n\n            stringParam('AUTO_ISSUE_SIMILARITY_THRESHOLD', '0.8', '''\n重複判定の類似度閾値\n\n0.0〜1.0の範囲で指定してください。\n値が高いほど厳密に重複判定します（デフォルト: 0.8）。\n            '''.stripIndent().trim())\n\n            textParam('CUSTOM_INSTRUCTION', '', '''\nカスタム指示（任意、最大500文字程度）\n\nエージェントへの追加ガイダンスを指定します。空欄の場合はデフォルト挙動で実行します。\n            '''.stripIndent().trim())\n\n            // ========================================\n            // 実行オプション\n            // ========================================\n            booleanParam('DRY_RUN', false, '''\nドライランモード（API 呼び出しや Git 操作を行わず動作確認のみ実施）\n            '''.stripIndent().trim())\n\n            // ========================================\n            // APIキー設定\n            // ========================================\n            nonStoredPasswordParam('GITHUB_TOKEN', '''\nGitHub Personal Access Token（任意）\nGitHub API呼び出しに使用されます\n            '''.stripIndent().trim())\n\n            nonStoredPasswordParam('OPENAI_API_KEY', '''\nOpenAI API キー（任意）\nCodex実行モードで使用されます\n            '''.stripIndent().trim())\n\n            nonStoredPasswordParam('CODEX_API_KEY', '''\nCodex API キー（任意）\nOPENAI_API_KEYの代替として使用可能\n            '''.stripIndent().trim())\n\n            textParam('CODEX_AUTH_JSON', '', '''\nCodex auth.json の内容（任意）\n\nCodex CLI 用の ~/.codex/auth.json を貼り付けます。ジョブ実行中のみ workspace/.codex/auth.json として展開され、完了後にクリーンアップされます。\n空欄の場合はファイルを作成しません。※ 入力内容はログに出力されません。\n            '''.stripIndent().trim())\n\n            nonStoredPasswordParam('CLAUDE_CODE_OAUTH_TOKEN', '''\nClaude Code OAuth トークン（任意）\nClaude実行モードで使用されます\n            '''.stripIndent().trim())\n\n            nonStoredPasswordParam('CLAUDE_CODE_API_KEY', '''\nClaude Code API キー（任意）\nClaude実行モードで使用されます\n            '''.stripIndent().trim())\n\n            nonStoredPasswordParam('ANTHROPIC_API_KEY', '''\nAnthropic API キー（任意）\nClaude実行モードで使用されます\n            '''.stripIndent().trim())\n\n            // ========================================\n            // その他\n            // ========================================\n            stringParam('COST_LIMIT_USD', '5.0', '''\nワークフローあたりのコスト上限（USD）\n            '''.stripIndent().trim())\n\n            choiceParam('LOG_LEVEL', ['INFO', 'DEBUG', 'WARNING', 'ERROR'], '''\nログレベル\n- INFO: 一般的な情報\n- DEBUG: 詳細ログ（デバッグ用）\n- WARNING / ERROR: 警告 / エラーのみ\n            '''.stripIndent().trim())\n        }\n\n        // ログローテーション\n        logRotator {\n            numToKeep(30)\n            daysToKeep(90)\n        }\n\n        // パイプライン定義\n        definition {\n            cpsScm {\n                scm {\n                    git {\n                        remote {\n                            url('https://github.com/tielec/ai-workflow-agent.git')\n                            credentials('github-token')\n                        }\n                        branch(gitBranch)\n                    }\n                }\n                scriptPath('jenkins/jobs/pipeline/ai-workflow/auto-issue/Jenkinsfile')\n            }\n        }\n\n        // 環境変数（EXECUTION_MODEを固定値として設定）\n        environmentVariables {\n            env('EXECUTION_MODE', 'auto_issue')\n            env('WORKFLOW_VERSION', '0.2.0')\n        }\n\n        // プロパティ\n        properties {\n            disableConcurrentBuilds()\n        }\n\n        // ジョブの無効化状態\n        disabled(false)\n    }\n}\n\n// 汎用フォルダ用ジョブを作成\ngenericFolders.each { folder ->\n    createJob(\n        \"AI_Workflow/${folder.name}/${jobConfig.name}\",\n        \"フォルダ: ${folder.displayName}\nブランチ: ${folder.branch}\",\n        folder.branch\n    )\n}\n"
        }
      ],
      "reply_message": "ご指摘ありがとうございます。JobDSL側に CUSTOM_INSTRUCTION の textParam を追加し、パラメータ数表記も更新して Jenkinsfile の引数と一致させます。修正を反映します。"
    }
  ]
}