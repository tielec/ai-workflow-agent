# 要件定義書 - Issue #58

## 0. Planning Documentの確認

Planning Phase（`.ai-workflow/issue-58/00_planning/output/planning.md`）で策定された開発計画を確認しました：

### 開発戦略サマリー
- **実装戦略**: EXTEND（既存実装の軽微な改善）
- **テスト戦略**: UNIT_INTEGRATION（ユニットテスト + 統合テスト）
- **テストコード戦略**: BOTH_TEST（既存テスト修正 + 新規テスト作成）
- **複雑度**: 簡単
- **見積もり工数**: 4~8時間
- **リスク評価**: 低

### スコープ確認
- Task 1: 正規表現パターンの改善（`sanitizeGitUrl()`）
- Task 2: トークン検出モニタリングスクリプト作成
- Task 3: マイグレーションコマンド実装（`ai-workflow migrate --sanitize-tokens`）

### 前提
- Issue #54で既に統合テスト100%成功済み
- Defense in Depthパターンで保護済み（`SecretMasker` + `sanitizeGitUrl()` の2層防御）
- すべてのタスクは低優先度（実運用への影響は極めて低い）

---

## 1. 概要

### 背景
Issue #54「Git URLs with embedded tokens should be sanitized in metadata」の実装において、Personal Access Tokenを含むGit URLのサニタイゼーション機能が実装されました。Evaluation Phase（Phase 9）で以下の3つの改善余地が特定されましたが、実運用への影響は極めて低いため、低優先度のフォローアップタスクとして分離されました。

### 目的
Issue #54で実装された機能の完成度をさらに高め、以下の観点で改善を図ります：
1. **テストカバレッジの向上**: パスワードに`@`を含むエッジケースへの対応
2. **観測可能性の向上**: トークン検出頻度のモニタリング
3. **ユーザビリティの向上**: 既存メタデータの自動修正ツール提供

### ビジネス価値
- **セキュリティ**: Personal Access Tokenの露出リスクをさらに低減（既にDefense in Depthで保護済み）
- **運用効率**: ユーザーが手動でメタデータを修正する手間を削減
- **品質**: テストの信頼性向上により、将来的なリグレッションを防止

### 技術的価値
- **保守性**: エッジケースへの対応により、長期的なコードの安定性を確保
- **観測可能性**: ログ分析により、機能の有効性を定量的に評価可能
- **自動化**: マイグレーションコマンドにより、既存ユーザーへの影響を最小化

---

## 2. 機能要件

### FR-1: 正規表現パターンの改善（Task 1）

**優先度**: 中（Planning Documentでは「低」だったが、ユニットテスト4件が失敗しているため、中に引き上げ）

**説明**: `src/utils/git-url-utils.ts` の `sanitizeGitUrl()` 関数で使用している正規表現パターンを改善し、パスワードに`@`を含むケースにも対応する。

**現在のパターン**:
```typescript
const tokenPattern = /^(https?:\/\/)[^@]+@([^@]+)$/;
```

**新しいパターン**:
```typescript
const tokenPattern = /^(https?:\/\/)(.+)@([^@]+)$/;
```

**変更箇所**:
- ファイル: `src/utils/git-url-utils.ts`（line 48）
- 影響範囲: 1行の変更

**副次的作業**:
- コメント更新（Issue #58参照を追加）
- テストケース修正（`tests/unit/utils/git-url-utils.test.ts`、4件のテストケース期待値更新）

**受け入れ基準**: 後述の「6. 受け入れ基準」セクション AC-1 を参照

---

### FR-2: トークン検出モニタリングスクリプト（Task 2）

**優先度**: 低

**説明**: トークン検出頻度を把握するため、ワークフローログを分析するスクリプトを作成する。`[WARNING] GitHub Personal Access Token detected` の出現頻度を集計し、2週間の期間にわたってレポートを生成する。

**機能詳細**:
1. **ログファイル読み込み**: ワークフロー実行ログ（`.ai-workflow/issue-*/execute/agent_log_raw.txt` 等）を探索
2. **警告メッセージ検出**: 正規表現パターンで `[WARNING] GitHub Personal Access Token detected` を検出
3. **統計集計**: 以下の情報を集計
   - 検出回数
   - Issue番号ごとの内訳
   - フェーズごとの内訳
   - 日付ごとのトレンド
4. **レポート出力**: Markdown形式でレポートを生成

**成果物**:
- スクリプト: `scripts/monitor-token-detection.ts`（約50~100行）
- レポート: `.ai-workflow/issue-58/08_report/output/monitoring_report.md`

**実行方法**:
```bash
npm run monitor:tokens
```

**受け入れ基準**: 後述の「6. 受け入れ基準」セクション AC-2 を参照

---

### FR-3: マイグレーションコマンド実装（Task 3）

**優先度**: 中（Planning Documentでは「低」だったが、ユーザー利便性向上のため、中に引き上げ）

**説明**: 過去に作成された `.ai-workflow/issue-*/metadata.json` に含まれるトークンを自動的に検出・削除するマイグレーションコマンドを実装する。

**機能詳細**:

#### 3.1. CLIインターフェース
```bash
# 基本的な使用方法
ai-workflow migrate --sanitize-tokens

# ドライラン（ファイルを変更せず、検出のみ）
ai-workflow migrate --sanitize-tokens --dry-run

# 特定のIssueのみ対象
ai-workflow migrate --sanitize-tokens --issue 123

# 対象リポジトリを指定
ai-workflow migrate --sanitize-tokens --repo /path/to/repo
```

#### 3.2. 処理フロー
1. **メタデータファイル探索**:
   - `.ai-workflow/issue-*/metadata.json` をすべて探索
   - `--issue` オプションが指定されている場合、特定のIssueのみを対象
2. **トークン検出**:
   - `metadata.json` 内の `target_repository.remote_url` フィールドをスキャン
   - HTTPS形式のURLに埋め込まれたPersonal Access Tokenを検出
3. **サニタイズ**:
   - `sanitizeGitUrl()` 関数を再利用してトークンを除去
   - SSH形式のURLは変更しない
4. **バックアップ作成**:
   - 変更前に `metadata.json.bak` ファイルを作成
   - バックアップは `.gitignore` に追加済み（Issue #54で対応済み）
5. **ファイル保存**:
   - `--dry-run` フラグが指定されていない場合のみ、変更を保存
6. **レポート出力**:
   - 処理した件数、検出したトークン数、エラー数をコンソールに出力

#### 3.3. エラーハンドリング
- **ファイル読み込み失敗**: エラーメッセージを表示して続行
- **JSON解析失敗**: 警告メッセージを表示して続行
- **ファイル書き込み失敗**: エラーメッセージを表示して中止
- **バックアップ作成失敗**: エラーメッセージを表示して中止

#### 3.4. セキュリティ考慮事項
- **パストラバーサル攻撃防止**: メタデータファイルパスを正規表現で検証（`.ai-workflow/issue-<NUM>/metadata.json` 形式）
- **シンボリックリンク攻撃防止**: ファイル操作前に `fs.lstatSync()` で検証
- **バックアップの自動削除禁止**: ユーザーが明示的に削除するまで保持

**実装ファイル**:
- コマンド本体: `src/commands/migrate.ts`（約200~300行）
  - `handleMigrateCommand()`: コマンドハンドラ
  - `sanitizeTokensInMetadata()`: メタデータファイルのサニタイズ処理
  - `findAllMetadataFiles()`: メタデータファイル探索
- CLI統合: `src/main.ts`（約10行追加）

**受け入れ基準**: 後述の「6. 受け入れ基準」セクション AC-3 を参照

---

## 3. 非機能要件

### NFR-1: パフォーマンス要件

- **NFR-1.1**: 正規表現パターン変更により、`sanitizeGitUrl()` 関数のパフォーマンスが低下しないこと
  - 目標: 既存実装と同等（1000回実行で10ms以内、Issue #54で計測済み）
  - ReDoS脆弱性がないこと（Design Phaseで評価）

- **NFR-1.2**: モニタリングスクリプトは、1000件のログファイルを10秒以内に処理できること
  - ファイルI/Oを効率的に実施（ストリーミング処理を推奨）

- **NFR-1.3**: マイグレーションコマンドは、100個のメタデータファイルを1分以内に処理できること
  - 進捗表示機能により、ユーザーに処理状況をリアルタイムで通知

### NFR-2: セキュリティ要件

- **NFR-2.1**: 正規表現パターンは、ReDoS（Regular Expression Denial of Service）脆弱性がないこと
  - Design Phaseで脆弱性評価を実施（`safe-regex` 等のツールを使用）

- **NFR-2.2**: マイグレーションコマンドは、以下のセキュリティ対策を実施すること
  - パストラバーサル攻撃防止（パス検証）
  - シンボリックリンク攻撃防止（`fs.lstatSync()` 検証）
  - バックアップファイルの自動削除禁止

- **NFR-2.3**: モニタリングスクリプトは、検出したトークンをレポートに出力しないこと
  - トークン文字列は `***` でマスキング

### NFR-3: 可用性・信頼性要件

- **NFR-3.1**: すべてのタスクは、失敗した場合でも実運用への影響がゼロであること
  - 既にDefense in Depthパターンで保護されている（Issue #54で対応済み）

- **NFR-3.2**: マイグレーションコマンドは、エラー発生時にロールバック可能であること
  - バックアップファイル（`.bak`）から復元可能

- **NFR-3.3**: モニタリングスクリプトは、ログファイルが存在しない場合でもエラーで終了しないこと
  - 警告メッセージを表示して続行

### NFR-4: 保守性・拡張性要件

- **NFR-4.1**: 正規表現パターン変更は、コメントで根拠を明記すること
  - Issue #58参照を追加
  - エッジケース（パスワードに`@`を含む）の説明を追加

- **NFR-4.2**: マイグレーションコマンドは、以下の拡張性を考慮すること
  - 将来的に他のサニタイズ処理を追加可能な設計
  - `--sanitize-tokens` 以外のオプション追加を想定

- **NFR-4.3**: すべてのコードは、TypeScript標準ライブラリと既存依存関係のみで実装すること
  - 新規依存関係の追加なし

### NFR-5: テスト要件

- **NFR-5.1**: Task 1の正規表現改善は、以下のテストを実施すること
  - ユニットテスト: 4件のテストケース期待値更新
  - 回帰テスト: 既存テストケースすべてがパス

- **NFR-5.2**: Task 3のマイグレーションコマンドは、以下のテストを実施すること
  - ユニットテスト: 正常系、エラー系、エッジケース
  - 統合テスト: E2Eフロー（既存メタデータ読み込み → サニタイズ → 保存 → 検証）
  - カバレッジ: 90%以上

- **NFR-5.3**: Task 2のモニタリングスクリプトは、テストコード不要
  - スクリプトとして実行し、レポートを手動検証

---

## 4. 制約事項

### 技術的制約

- **TC-1**: TypeScript 5.x、Node.js 20以上
- **TC-2**: 既存のTypeScript標準ライブラリと依存関係のみ使用（新規依存追加なし）
  - 使用可能: `fs-extra`, `commander`, `glob`
- **TC-3**: 既存のコーディング規約に準拠（ESLint、統一loggerモジュール使用）
- **TC-4**: Git URLサニタイゼーションは既存の `sanitizeGitUrl()` 関数を再利用
- **TC-5**: すべてのログ出力は統一loggerモジュール（`src/utils/logger.ts`）を使用
  - `console.log`/`console.error` 等の直接使用は禁止（ESLintの `no-console` ルールで強制）

### リソース制約

- **RC-1**: 見積もり工数: 4~8時間（Planning Document参照）
  - Task 1: 1~2時間
  - Task 2: 1~2時間
  - Task 3: 2~4時間
- **RC-2**: 開発者: 1名（AIエージェント）
- **RC-3**: 予算制約: なし（既存インフラで実施）

### ポリシー制約

- **PC-1**: Issue #54のEvaluation Reportとの整合性を維持
  - すべてのタスクは「低優先度」として評価されている
  - 実運用への影響は極めて低い
- **PC-2**: Defense in Depthパターンの原則を維持
  - `SecretMasker` + `sanitizeGitUrl()` の2層防御を保持
- **PC-3**: 後方互換性を維持
  - 既存のワークフローに影響を与えない
  - マイグレーションコマンドはオプション（ユーザーの選択を尊重）

---

## 5. 前提条件

### システム環境

- **ENV-1**: TypeScript 5.x、Node.js 20以上がインストール済み
- **ENV-2**: Git 2.x以上がインストール済み
- **ENV-3**: GitHub パーソナルアクセストークン（`GITHUB_TOKEN`）が設定済み

### 依存コンポーネント

- **DEP-1**: Issue #54の実装が完了していること
  - `src/utils/git-url-utils.ts` の `sanitizeGitUrl()` 関数
  - `src/core/secret-masker.ts` の `SecretMasker` クラス
  - 統合テスト100%成功済み
- **DEP-2**: 既存の `.ai-workflow/issue-*/metadata.json` 構造が変更されていないこと
  - `target_repository.remote_url` フィールドが存在

### 外部システム連携

- **EXT-1**: GitHubへの依存なし（すべてローカルで実行可能）
- **EXT-2**: 外部APIへの依存なし

---

## 6. 受け入れ基準

### AC-1: Task 1（正規表現パターン改善）

#### AC-1.1: 正規表現パターンが変更されている

**Given**: `src/utils/git-url-utils.ts` ファイルが存在する
**When**: line 48の正規表現パターンを確認する
**Then**: `/^(https?:\/\/)(.+)@([^@]+)$/` に変更されていること

#### AC-1.2: コメントが更新されている

**Given**: `src/utils/git-url-utils.ts` ファイルが存在する
**When**: 正規表現パターン周辺のコメントを確認する
**Then**: Issue #58参照とエッジケースの説明が追加されていること

#### AC-1.3: テストケースが修正されている

**Given**: `tests/unit/utils/git-url-utils.test.ts` ファイルが存在する
**When**: テストケースを確認する
**Then**: 4件のテストケース期待値が更新されていること

#### AC-1.4: すべてのユニットテストがパスする

**Given**: 正規表現パターンとテストケースが修正されている
**When**: `npm run test:unit -- git-url-utils` を実行する
**Then**: すべてのテストがパスすること（エラー0件）

#### AC-1.5: 回帰テストがパスする

**Given**: 正規表現パターンが修正されている
**When**: 既存のテストケース（パスワードに`@`を含まないケース）を実行する
**Then**: すべてのテストがパスすること（後方互換性を維持）

#### AC-1.6: ReDoS脆弱性がない

**Given**: 新しい正規表現パターン `/^(https?:\/\/)(.+)@([^@]+)$/` が定義されている
**When**: Design Phaseで脆弱性評価を実施する
**Then**: ReDoS脆弱性がないこと（`safe-regex` 等のツールで検証）

---

### AC-2: Task 2（モニタリングスクリプト）

#### AC-2.1: スクリプトが作成されている

**Given**: プロジェクトルートディレクトリ
**When**: `scripts/monitor-token-detection.ts` ファイルを確認する
**Then**: ファイルが存在し、約50~100行のコードが記述されていること

#### AC-2.2: ログファイル読み込みが実装されている

**Given**: `.ai-workflow/issue-*/execute/agent_log_raw.txt` が存在する
**When**: スクリプトを実行する
**Then**: ログファイルが正しく読み込まれること

#### AC-2.3: 警告メッセージ検出が実装されている

**Given**: ログファイルに `[WARNING] GitHub Personal Access Token detected` が含まれる
**When**: スクリプトを実行する
**Then**: 警告メッセージがすべて検出されること

#### AC-2.4: 統計集計が実装されている

**Given**: 複数のログファイルが存在する
**When**: スクリプトを実行する
**Then**: 以下の統計が集計されること
- 検出回数
- Issue番号ごとの内訳
- フェーズごとの内訳
- 日付ごとのトレンド

#### AC-2.5: レポートが出力される

**Given**: スクリプトが実行される
**When**: 実行完了後、レポートファイルを確認する
**Then**: `.ai-workflow/issue-58/08_report/output/monitoring_report.md` が生成されていること

#### AC-2.6: レポート形式が適切である

**Given**: レポートファイルが生成されている
**When**: レポート内容を確認する
**Then**: Markdown形式で、統計情報が視覚的に理解しやすい形で記述されていること

#### AC-2.7: トークンがマスキングされている

**Given**: レポートファイルが生成されている
**When**: レポート内容を確認する
**Then**: 検出したトークン文字列が `***` でマスキングされていること

#### AC-2.8: エラーハンドリングが実装されている

**Given**: ログファイルが存在しない
**When**: スクリプトを実行する
**Then**: 警告メッセージを表示して続行すること（エラーで終了しない）

---

### AC-3: Task 3（マイグレーションコマンド）

#### AC-3.1: CLIコマンドが追加されている

**Given**: `src/main.ts` ファイルが存在する
**When**: CLI定義を確認する
**Then**: `migrate` コマンドが追加されていること（約10行追加）

#### AC-3.2: コマンドハンドラが実装されている

**Given**: `src/commands/migrate.ts` ファイルが存在する
**When**: ファイル内容を確認する
**Then**: `handleMigrateCommand()` 関数が実装されていること（約200~300行）

#### AC-3.3: メタデータファイル探索が実装されている

**Given**: `.ai-workflow/issue-*/metadata.json` が複数存在する
**When**: `ai-workflow migrate --sanitize-tokens` を実行する
**Then**: すべてのメタデータファイルが探索されること

#### AC-3.4: トークン検出が実装されている

**Given**: `metadata.json` の `target_repository.remote_url` にトークンが含まれる
**When**: マイグレーションコマンドを実行する
**Then**: トークンが正しく検出されること

#### AC-3.5: サニタイズが実装されている

**Given**: トークンが検出されている
**When**: サニタイズ処理を実行する
**Then**: `sanitizeGitUrl()` 関数を再利用してトークンが除去されること

#### AC-3.6: SSH形式のURLは変更されない

**Given**: `metadata.json` の `remote_url` がSSH形式（`git@github.com:owner/repo.git`）
**When**: サニタイズ処理を実行する
**Then**: URLが変更されないこと

#### AC-3.7: バックアップが作成される

**Given**: マイグレーションコマンドが実行される
**When**: メタデータファイルが変更される
**Then**: `metadata.json.bak` ファイルが作成されること

#### AC-3.8: ドライラン機能が実装されている

**Given**: `ai-workflow migrate --sanitize-tokens --dry-run` を実行する
**When**: 処理が完了する
**Then**: ファイルが変更されていないこと（検出結果のみ表示）

#### AC-3.9: レポート出力が実装されている

**Given**: マイグレーションコマンドが実行される
**When**: 処理が完了する
**Then**: 以下の情報がコンソールに出力されること
- 処理した件数
- 検出したトークン数
- エラー数

#### AC-3.10: エラーハンドリングが実装されている

**Given**: ファイル読み込みまたは書き込みが失敗する
**When**: マイグレーションコマンドを実行する
**Then**: 適切なエラーメッセージが表示されること

#### AC-3.11: セキュリティ対策が実装されている

**Given**: マイグレーションコマンドが実行される
**When**: ファイル操作前にパス検証を実施する
**Then**: 以下の検証が行われること
- パストラバーサル攻撃防止（正規表現によるパス検証）
- シンボリックリンク攻撃防止（`fs.lstatSync()` 検証）

#### AC-3.12: ユニットテストが作成されている

**Given**: `tests/unit/commands/migrate.test.ts` ファイルが存在する
**When**: テスト内容を確認する
**Then**: 以下のテストケースが実装されていること
- 正常系（トークン検出 → サニタイズ）
- エラー系（ファイル読み込み失敗、書き込み失敗）
- エッジケース（空メタデータ、トークンなし）

#### AC-3.13: 統合テストが作成されている

**Given**: `tests/integration/migrate-sanitize-tokens.test.ts` ファイルが存在する
**When**: テスト内容を確認する
**Then**: 以下のテストケースが実装されていること
- E2Eフローテスト（既存メタデータ読み込み → サニタイズ → 保存 → 検証）
- ドライランテスト（`--dry-run` でファイルが変更されないこと）

#### AC-3.14: すべてのテストがパスする

**Given**: ユニットテストと統合テストが作成されている
**When**: `npm run test:unit -- migrate` と `npm run test:integration -- migrate-sanitize-tokens` を実行する
**Then**: すべてのテストがパスすること（エラー0件）

#### AC-3.15: カバレッジが90%以上である

**Given**: テストが実装されている
**When**: `npm run test:coverage` を実行する
**Then**: マイグレーションコマンドのカバレッジが90%以上であること

---

### AC-4: 全体的な受け入れ基準

#### AC-4.1: TypeScriptコンパイルが成功する

**Given**: すべてのコードが実装されている
**When**: `npm run build` を実行する
**Then**: コンパイルエラーが0件であること

#### AC-4.2: ESLintチェックが通過する

**Given**: すべてのコードが実装されている
**When**: `npm run lint` を実行する
**Then**: ESLintエラーが0件であること

#### AC-4.3: すべてのテストがパスする

**Given**: すべてのテストコードが実装されている
**When**: `npm test` を実行する
**Then**: すべてのテストがパスすること（エラー0件）

#### AC-4.4: ドキュメントが更新されている

**Given**: 実装が完了している
**When**: `docs/MIGRATION.md` と `TROUBLESHOOTING.md` を確認する
**Then**: マイグレーションコマンドの使用方法が記載されていること

#### AC-4.5: 回帰テストがパスする

**Given**: すべての実装が完了している
**When**: 既存のテストケース（Issue #54で追加されたテスト）を実行する
**Then**: すべてのテストがパスすること（後方互換性を維持）

---

## 7. スコープ外

以下の項目は明確にスコープ外とします：

### OUT-1: 自動マイグレーション機能
- マイグレーションコマンドはユーザーが明示的に実行する場合のみ動作
- ワークフロー初期化時やフェーズ実行時の自動実行は実施しない
- 理由: ユーザーの選択を尊重、予期しないファイル変更を防止

### OUT-2: トークン検出の自動通知機能
- モニタリングスクリプトは集計・レポート生成のみ
- 検出時のSlack/Emailへの自動通知は実装しない
- 理由: 外部サービス連携は別Issueで検討

### OUT-3: Git URLサニタイゼーションの対象拡大
- Personal Access Token以外の認証情報（OAuth Token、SSH秘密鍵等）の検出は対象外
- 理由: Issue #54のスコープ外であり、リスク評価が未実施

### OUT-4: メタデータ構造の変更
- `target_repository` オブジェクトの構造変更は実施しない
- 新規フィールドの追加は実施しない
- 理由: 後方互換性を維持

### OUT-5: UI/UX改善
- マイグレーションコマンドの進捗バー、カラー出力等の高度なUI機能は実装しない
- 理由: 工数制約（Nice to Haveとして将来的に検討）

### OUT-6: 他のGit URLプロトコル対応
- `file://`, `ftp://` 等の非標準プロトコルは対象外
- 理由: 実運用で使用されていない

### OUT-7: ReDoS脆弱性の自動修正
- 正規表現パターンの脆弱性は手動で評価・修正
- 自動修正ツールの実装は行わない
- 理由: 複雑性が高く、工数オーバーのリスク

---

## 8. 将来的な拡張候補

以下の項目は将来的な拡張候補として記録します（本Issueでは実装しない）：

### EXT-1: 自動バックアップ機能の拡張
- バックアップファイルの世代管理（最大N件まで保持）
- バックアップファイルの自動削除機能（ユーザー設定に基づく）

### EXT-2: マイグレーションコマンドのロールバック機能
- `ai-workflow migrate --rollback` コマンド
- `.bak` ファイルから自動復元

### EXT-3: トークン検出の自動通知機能
- Slack/Email/GitHub Issueへの自動通知
- 閾値設定（N回以上検出された場合のみ通知）

### EXT-4: 進捗表示機能の強化
- 進捗バー（`cli-progress` 等のライブラリを使用）
- カラー出力（`chalk` を使用）

### EXT-5: モニタリングスクリプトのダッシュボード化
- Webダッシュボード（React + Chart.js）
- リアルタイム更新機能

### EXT-6: 他の認証情報の検出
- OAuth Token、SSH秘密鍵、API Key等
- 汎用的なシークレット検出フレームワークの構築

---

## 9. 付録

### A. 用語集

| 用語 | 説明 |
|------|------|
| **Personal Access Token (PAT)** | GitHubの認証に使用するトークン。HTTPSプロトコルでGit操作を行う際に使用される。 |
| **Defense in Depth** | 多層防御戦略。複数のセキュリティ対策を組み合わせてリスクを低減するアプローチ。 |
| **ReDoS** | Regular Expression Denial of Service。悪意のある入力により、正規表現の処理時間が指数関数的に増加する脆弱性。 |
| **ドライラン** | 実際の変更を行わず、処理のシミュレーションのみを実行する機能。 |
| **マイグレーションコマンド** | 既存データを新しい形式に変換するためのコマンド。 |
| **SecretMasker** | 機密情報（トークン、パスワード等）をマスキング（`***` に置換）するクラス（Issue #54で実装）。 |

### B. 参考リンク

- **元Issue**: [Issue #54 - Git URLs with embedded tokens should be sanitized in metadata](https://github.com/tielec/ai-workflow-agent/issues/54)
- **Evaluation Report**: `.ai-workflow/issue-54/09_evaluation/output/evaluation_report.md`
- **Planning Document**: `.ai-workflow/issue-58/00_planning/output/planning.md`
- **CLAUDE.md**: プロジェクトの全体方針とコーディングガイドライン
- **ARCHITECTURE.md**: アーキテクチャ設計思想
- **README.md**: プロジェクト概要と使用方法

### C. レビュー観点

この要件定義書をレビューする際、以下の観点を重点的に確認してください：

#### C.1. 機能要件の完全性
- [ ] Issue本文の「残タスク一覧」3項目がすべてカバーされているか
- [ ] Planning Documentとの整合性が取れているか
- [ ] 受け入れ基準が検証可能（テスト可能）な形で記述されているか

#### C.2. 非機能要件の具体性
- [ ] パフォーマンス要件が測定可能な形で記述されているか
- [ ] セキュリティ要件（ReDoS、パストラバーサル等）が明確に定義されているか
- [ ] テスト要件（カバレッジ90%以上）が明確に定義されているか

#### C.3. スコープの明確性
- [ ] スコープ外項目が明確に記載されているか
- [ ] 将来的な拡張候補が整理されているか

#### C.4. 受け入れ基準の網羅性
- [ ] 各機能要件（FR-1, FR-2, FR-3）に対して受け入れ基準が定義されているか
- [ ] Given-When-Then形式で記述されているか
- [ ] エッジケース（空ファイル、トークンなし等）がカバーされているか

#### C.5. 論理的整合性
- [ ] 機能要件と受け入れ基準の間に矛盾がないか
- [ ] 非機能要件と制約事項の間に矛盾がないか
- [ ] Planning Documentの優先度評価（低）と本要件定義書の優先度（中/低）が適切に説明されているか

---

**作成日**: 2025-01-22
**作成者**: AI Workflow Agent (Phase 1: Requirements)
**承認者**: （レビュー完了後に記載）
**バージョン**: 1.0
**次ステップ**: Phase 2 (Design) へ進む
