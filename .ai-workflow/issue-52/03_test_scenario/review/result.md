レビューを開始します。まず、Planning Documentを確認してチェックリストとの照合を行います。
Planning Documentから、Phase 3のチェックリストを抽出しました。次に、test-scenario.mdの内容と照合してplanning.mdを更新します。

### Phase 3のチェックリスト（Planning.md 181-197行）

```markdown
- [ ] Task 3-1: FileSelector のテストシナリオ (1h)
  - getChangedFiles のシナリオ（git status 解析、@tmp 除外）
  - filterPhaseFiles のシナリオ（Issue番号フィルタリング）
  - getPhaseSpecificFiles のシナリオ（implementation, test_implementation, documentation）
  - scanDirectories のシナリオ（複数ディレクトリスキャン）
  - scanByPatterns のシナリオ（minimatch パターン検証）

- [ ] Task 3-2: CommitMessageBuilder のテストシナリオ (0.5h)
  - createCommitMessage のシナリオ（フェーズ完了メッセージ）
  - buildStepCommitMessage のシナリオ（ステップ完了メッセージ）
  - createInitCommitMessage のシナリオ（初期化メッセージ）
  - createCleanupCommitMessage のシナリオ（クリーンアップメッセージ）

- [ ] Task 3-3: CommitManager 委譲動作のテストシナリオ (0.5h)
  - commitPhaseOutput の委譲検証（FileSelector + CommitMessageBuilder 統合）
  - commitStepOutput の委譲検証
  - 後方互換性検証（既存テストスイートの実行）
```

test-scenario.mdと照合すると、**すべてのタスクが完了しています**：

✅ **Task 3-1**: 完了
- getChangedFiles のシナリオ: 2.1節（5ケース）
- filterPhaseFiles のシナリオ: 2.2節（4ケース）
- getPhaseSpecificFiles のシナリオ: 2.3節（4ケース）
- scanDirectories のシナリオ: 2.4節（4ケース）
- scanByPatterns のシナリオ: 2.5節（6ケース）

✅ **Task 3-2**: 完了
- createCommitMessage のシナリオ: 2.6節（4ケース）
- buildStepCommitMessage のシナリオ: 2.7節（2ケース）
- createInitCommitMessage のシナリオ: 2.8節（1ケース）
- createCleanupCommitMessage のシナリオ: 2.9節（2ケース）

✅ **Task 3-3**: 完了
- commitPhaseOutput の委譲検証: 2.10節（3ケース）
- commitStepOutput の委譲検証: 2.11節（1ケース）
- commitWorkflowInit の委譲検証: 2.12節（1ケース）
- commitCleanupLogs の委譲検証: 2.13節（1ケース）
- 後方互換性検証: 3.2節（2シナリオ）

Planning.mdを更新します。
次に、品質ゲートセクションのPhase 3部分も更新します。
Planning.mdの更新が完了しました。すべてのタスクが完了していることを確認できたので、次に詳細なレビューを実施します。

---

## 品質ゲート評価

**⚠️ 重要: 各項目に対して明示的にPASS/FAILを判定してください。1つでもFAILがあれば最終判定は自動的にFAILです。**

- [x] **Phase 2の戦略に沿ったテストシナリオである**: **PASS** - Phase 2で決定されたUNIT_INTEGRATION戦略に完全に準拠しています。セクション2でUnitテストシナリオ（FileSelector、CommitMessageBuilder、CommitManagerの全メソッド）を39ケース網羅し、セクション3でIntegrationテストシナリオ（GitManager統合、後方互換性検証、エンドツーエンド統合）を7シナリオ実装しています。

- [x] **主要な正常系がカバーされている**: **PASS** - すべての主要な正常系が詳細にカバーされています。FileSelector（getChangedFiles、filterPhaseFiles、getPhaseSpecificFiles等の正常系）、CommitMessageBuilder（全メッセージタイプの正常系）、CommitManager（委譲動作の正常系）、統合テスト（フェーズ出力コミット、ステップ出力コミットのエンドツーエンド）がすべて網羅されています。

- [x] **主要な異常系がカバーされている**: **PASS** - 主要な異常系が適切にカバーされています。FileSelector（@tmp除外、重複除去、空のファイルリスト、該当ファイルなし）、CommitMessageBuilder（reviewResult未指定）、CommitManager（Issue番号なし、変更ファイルなし）、統合テスト（複数Issueのファイル混在、SecretMasker統合）など、境界値テストと異常系が十分に記述されています。

- [x] **期待結果が明確である**: **PASS** - すべてのテストケースで期待結果が具体的かつ検証可能な形で記述されています。入力データ、期待される出力、検証項目がチェックリスト形式で明確に記載されており、テスト実行時に判定可能です。

**品質ゲート総合判定: PASS**
- PASS: 上記4項目すべてがPASS

## 詳細レビュー

### 1. テスト戦略との整合性

**良好な点**:
- **UNIT_INTEGRATION戦略に完全準拠**: セクション2でUnitテストシナリオ（39ケース）、セクション3でIntegrationテストシナリオ（7シナリオ）を明確に分離して記述
- **設計書との対応が明確**: Phase 2で設計されたFileSelector、CommitMessageBuilder、CommitManagerの3モジュールすべてに対してテストシナリオが網羅されている
- **テスト階層が適切**: Unitテストでモックによる独立検証、Integrationテストで実環境での統合検証と、階層が明確に設計されている

**懸念点**:
- なし

### 2. 正常系のカバレッジ

**良好な点**:
- **主要メソッドの正常系が完全カバー**: FileSelector（5メソッド × 1~2正常系 = 9ケース）、CommitMessageBuilder（4メソッド × 1~2正常系 = 7ケース）、CommitManager（4メソッド × 1正常系 = 4ケース）がすべて網羅
- **クリティカルパスの検証**: commitPhaseOutput → FileSelector → CommitMessageBuilder → Git commit のエンドツーエンドフローが統合テスト（シナリオ3.1.1）で検証される
- **ハッピーパスが明確**: 各テストケースの「前提条件」「入力」「期待結果」が明確に定義され、実行可能な形式で記述されている

**懸念点**:
- なし

### 3. 異常系のカバレッジ

**良好な点**:
- **境界値テストが充実**: FileSelector（@tmp除外、重複除去、空のファイルリスト、該当ファイルなし）、CommitManager（Issue番号なし、変更ファイルなし）など、境界値ケースが23ケース含まれている
- **エラーハンドリングの検証**: Issue番号なしの場合のエラー処理（テストケース2.10.2）が明確に定義されている
- **エッジケースの考慮**: minimatchの2つのマッチング方式（テストケース2.5.3）、renamedファイルの処理（テストケース2.1.4）など、特殊ケースが網羅されている

**改善の余地**:
- **Git操作失敗時のエラーハンドリング**: テストシナリオに含まれていませんが、設計書（design.md 907-914行）に記述されているため、実装フェーズで補完可能です。（SUGGESTION扱い）

### 4. 期待結果の明確性

**良好な点**:
- **具体的な期待値**: すべてのテストケースで具体的な入力データと期待される出力が明記されている（例: テストケース2.1.1の `['src/new-file.ts', 'src/created.ts', 'src/modified.ts', 'src/staged.ts']`）
- **検証可能な形式**: 統合テストの「確認項目」（シナリオ3.1.1の1004-1008行）がチェックリスト形式で記述され、テスト実行時に判定可能
- **コミットメッセージフォーマット検証**: CommitMessageBuilder のテストケース（2.6節、2.7節等）で期待されるメッセージフォーマットが完全に記述されている

**懸念点**:
- なし

### 5. 要件との対応

**良好な点**:
- **要件定義書の受け入れ基準との対応**: requirements.md（セクション6）の受け入れ基準がすべてテストシナリオに反映されている
  - AC-6.1.1~6.1.7: FileSelector のテストケース2.1~2.5節に対応
  - AC-6.2.1~6.2.4: CommitMessageBuilder のテストケース2.6~2.9節に対応
  - AC-6.3.1~6.3.3: CommitManager のテストケース2.10~2.13節、統合テスト3.2節に対応
- **Planning Phaseチェックリストとの完全一致**: すべてのタスク（Task 3-1、3-2、3-3）が完了し、planning.mdのチェックボックスが更新されました

**改善の余地**:
- なし

### 6. 実行可能性

**良好な点**:
- **テストデータが具体的**: セクション4でGit Statusモックデータ、ファイルリストテストデータ、CommitResultテストデータが詳細に定義されている（1142-1288行）
- **前提条件が明確**: 各テストケースの「前提条件」セクションでモック設定、テスト環境の要件が明記されている
- **テスト環境要件が詳細**: セクション5でNode.js、Git、Jest等の必要なツールとモック/スタブの必要性が明確に文書化されている（1292-1351行）

**懸念点**:
- なし

## 改善提案（SUGGESTION）

**次フェーズに進めるが、改善が望ましい事項**

1. **Git操作失敗時のエラーハンドリングテスト**
   - 現状: テストシナリオに含まれていない
   - 提案: git.commit()失敗時のエラーハンドリング（設計書907-914行に記述）をテストシナリオに追加すると、より堅牢なテストになる
   - 効果: Git操作失敗時の挙動を明確に検証できる
   - **重要度**: 低（設計書に記述されており、実装フェーズで補完可能）

2. **パフォーマンステストシナリオの追加**
   - 現状: 統合テストで「パフォーマンス劣化がない（±5%以内）」と記述（1062行、1185行）されているが、具体的な計測方法が未定義
   - 提案: 統合テストにパフォーマンス計測の具体的なシナリオ（実行時間の計測方法、ベースライン設定）を追加すると、より明確になる
   - 効果: リファクタリング後のパフォーマンス検証が定量的に実施できる
   - **重要度**: 低（非機能要件への対応であり、次フェーズでも補完可能）

3. **SecretMaskerエラー時のテストケース追加**
   - 現状: SecretMasker統合の検証（シナリオ3.4.1）は正常系のみ
   - 提案: SecretMaskerがエラーを返した場合のCommitManager挙動（設計書877-880行: "Continue with commit (don't block)"）をテストシナリオに追加
   - 効果: SecretMasker失敗時もコミットが継続されることを明確に検証できる
   - **重要度**: 低（設計書に記述されており、実装フェーズで補完可能）

## 総合評価

**主な強み**:
- **Phase 2戦略との完全一致**: UNIT_INTEGRATION戦略に準拠した包括的なテストシナリオ（Unitテスト39ケース、Integrationテスト7シナリオ）
- **要件定義書との完全対応**: requirements.mdの受け入れ基準がすべてテストシナリオに反映されている
- **実装可能性が高い**: テストデータが具体的に定義され、前提条件が明確で、すぐに実装フェーズに移行可能
- **品質ゲート完全達成**: Phase 3の4つの品質ゲート（戦略準拠、正常系カバレッジ、異常系カバレッジ、期待結果の明確性）をすべて満たす
- **後方互換性検証が充実**: 既存の統合テスト（step-commit-push.test.ts）を活用した後方互換性検証シナリオ（3.2節）が明確

**主な改善提案**:
- Git操作失敗時のエラーハンドリングテスト（SUGGESTION: 設計書に記述済み、実装フェーズで補完可能）
- パフォーマンステストの具体的な計測方法の定義（SUGGESTION: 非機能要件、次フェーズで補完可能）
- SecretMaskerエラー時のテストケース追加（SUGGESTION: 設計書に記述済み、実装フェーズで補完可能）

このテストシナリオは、**「80点で十分」の原則を大幅に上回る品質**を達成しています。主要な正常系・異常系がすべてカバーされ、期待結果が明確で、すぐに実装フェーズに移行できる状態です。改善提案はすべて「より良くなる」レベルであり、次フェーズに進めない問題は存在しません。

**Planning Phaseチェックリスト照合結果**: すべてのタスク（Task 3-1、3-2、3-3）が完了しました。planning.mdのチェックボックスを更新しました。

---
**判定: PASS**
Planning.mdの更新が完了しました。すべてのタスクが完了していることを確認できたので、次に詳細なレビューを実施します。

---

## 品質ゲート評価

**⚠️ 重要: 各項目に対して明示的にPASS/FAILを判定してください。1つでもFAILがあれば最終判定は自動的にFAILです。**

- [x] **Phase 2の戦略に沿ったテストシナリオである**: **PASS** - Phase 2で決定されたUNIT_INTEGRATION戦略に完全に準拠しています。セクション2でUnitテストシナリオ（FileSelector、CommitMessageBuilder、CommitManagerの全メソッド）を39ケース網羅し、セクション3でIntegrationテストシナリオ（GitManager統合、後方互換性検証、エンドツーエンド統合）を7シナリオ実装しています。

- [x] **主要な正常系がカバーされている**: **PASS** - すべての主要な正常系が詳細にカバーされています。FileSelector（getChangedFiles、filterPhaseFiles、getPhaseSpecificFiles等の正常系）、CommitMessageBuilder（全メッセージタイプの正常系）、CommitManager（委譲動作の正常系）、統合テスト（フェーズ出力コミット、ステップ出力コミットのエンドツーエンド）がすべて網羅されています。

- [x] **主要な異常系がカバーされている**: **PASS** - 主要な異常系が適切にカバーされています。FileSelector（@tmp除外、重複除去、空のファイルリスト、該当ファイルなし）、CommitMessageBuilder（reviewResult未指定）、CommitManager（Issue番号なし、変更ファイルなし）、統合テスト（複数Issueのファイル混在、SecretMasker統合）など、境界値テストと異常系が十分に記述されています。

- [x] **期待結果が明確である**: **PASS** - すべてのテストケースで期待結果が具体的かつ検証可能な形で記述されています。入力データ、期待される出力、検証項目がチェックリスト形式で明確に記載されており、テスト実行時に判定可能です。

**品質ゲート総合判定: PASS**
- PASS: 上記4項目すべてがPASS

## 詳細レビュー

### 1. テスト戦略との整合性

**良好な点**:
- **UNIT_INTEGRATION戦略に完全準拠**: セクション2でUnitテストシナリオ（39ケース）、セクション3でIntegrationテストシナリオ（7シナリオ）を明確に分離して記述
- **設計書との対応が明確**: Phase 2で設計されたFileSelector、CommitMessageBuilder、CommitManagerの3モジュールすべてに対してテストシナリオが網羅されている
- **テスト階層が適切**: Unitテストでモックによる独立検証、Integrationテストで実環境での統合検証と、階層が明確に設計されている

**懸念点**:
- なし

### 2. 正常系のカバレッジ

**良好な点**:
- **主要メソッドの正常系が完全カバー**: FileSelector（5メソッド × 1~2正常系 = 9ケース）、CommitMessageBuilder（4メソッド × 1~2正常系 = 7ケース）、CommitManager（4メソッド × 1正常系 = 4ケース）がすべて網羅
- **クリティカルパスの検証**: commitPhaseOutput → FileSelector → CommitMessageBuilder → Git commit のエンドツーエンドフローが統合テスト（シナリオ3.1.1）で検証される
- **ハッピーパスが明確**: 各テストケースの「前提条件」「入力」「期待結果」が明確に定義され、実行可能な形式で記述されている

**懸念点**:
- なし

### 3. 異常系のカバレッジ

**良好な点**:
- **境界値テストが充実**: FileSelector（@tmp除外、重複除去、空のファイルリスト、該当ファイルなし）、CommitManager（Issue番号なし、変更ファイルなし）など、境界値ケースが23ケース含まれている
- **エラーハンドリングの検証**: Issue番号なしの場合のエラー処理（テストケース2.10.2）が明確に定義されている
- **エッジケースの考慮**: minimatchの2つのマッチング方式（テストケース2.5.3）、renamedファイルの処理（テストケース2.1.4）など、特殊ケースが網羅されている

**改善の余地**:
- **Git操作失敗時のエラーハンドリング**: テストシナリオに含まれていませんが、設計書（design.md 907-914行）に記述されているため、実装フェーズで補完可能です。（SUGGESTION扱い）

### 4. 期待結果の明確性

**良好な点**:
- **具体的な期待値**: すべてのテストケースで具体的な入力データと期待される出力が明記されている（例: テストケース2.1.1の `['src/new-file.ts', 'src/created.ts', 'src/modified.ts', 'src/staged.ts']`）
- **検証可能な形式**: 統合テストの「確認項目」（シナリオ3.1.1の1004-1008行）がチェックリスト形式で記述され、テスト実行時に判定可能
- **コミットメッセージフォーマット検証**: CommitMessageBuilder のテストケース（2.6節、2.7節等）で期待されるメッセージフォーマットが完全に記述されている

**懸念点**:
- なし

### 5. 要件との対応

**良好な点**:
- **要件定義書の受け入れ基準との対応**: requirements.md（セクション6）の受け入れ基準がすべてテストシナリオに反映されている
  - AC-6.1.1~6.1.7: FileSelector のテストケース2.1~2.5節に対応
  - AC-6.2.1~6.2.4: CommitMessageBuilder のテストケース2.6~2.9節に対応
  - AC-6.3.1~6.3.3: CommitManager のテストケース2.10~2.13節、統合テスト3.2節に対応
- **Planning Phaseチェックリストとの完全一致**: すべてのタスク（Task 3-1、3-2、3-3）が完了し、planning.mdのチェックボックスが更新されました

**改善の余地**:
- なし

### 6. 実行可能性

**良好な点**:
- **テストデータが具体的**: セクション4でGit Statusモックデータ、ファイルリストテストデータ、CommitResultテストデータが詳細に定義されている（1142-1288行）
- **前提条件が明確**: 各テストケースの「前提条件」セクションでモック設定、テスト環境の要件が明記されている
- **テスト環境要件が詳細**: セクション5でNode.js、Git、Jest等の必要なツールとモック/スタブの必要性が明確に文書化されている（1292-1351行）

**懸念点**:
- なし

## 改善提案（SUGGESTION）

**次フェーズに進めるが、改善が望ましい事項**

1. **Git操作失敗時のエラーハンドリングテスト**
   - 現状: テストシナリオに含まれていない
   - 提案: git.commit()失敗時のエラーハンドリング（設計書907-914行に記述）をテストシナリオに追加すると、より堅牢なテストになる
   - 効果: Git操作失敗時の挙動を明確に検証できる
   - **重要度**: 低（設計書に記述されており、実装フェーズで補完可能）

2. **パフォーマンステストシナリオの追加**
   - 現状: 統合テストで「パフォーマンス劣化がない（±5%以内）」と記述（1062行、1185行）されているが、具体的な計測方法が未定義
   - 提案: 統合テストにパフォーマンス計測の具体的なシナリオ（実行時間の計測方法、ベースライン設定）を追加すると、より明確になる
   - 効果: リファクタリング後のパフォーマンス検証が定量的に実施できる
   - **重要度**: 低（非機能要件への対応であり、次フェーズでも補完可能）

3. **SecretMaskerエラー時のテストケース追加**
   - 現状: SecretMasker統合の検証（シナリオ3.4.1）は正常系のみ
   - 提案: SecretMaskerがエラーを返した場合のCommitManager挙動（設計書877-880行: "Continue with commit (don't block)"）をテストシナリオに追加
   - 効果: SecretMasker失敗時もコミットが継続されることを明確に検証できる
   - **重要度**: 低（設計書に記述されており、実装フェーズで補完可能）

## 総合評価

**主な強み**:
- **Phase 2戦略との完全一致**: UNIT_INTEGRATION戦略に準拠した包括的なテストシナリオ（Unitテスト39ケース、Integrationテスト7シナリオ）
- **要件定義書との完全対応**: requirements.mdの受け入れ基準がすべてテストシナリオに反映されている
- **実装可能性が高い**: テストデータが具体的に定義され、前提条件が明確で、すぐに実装フェーズに移行可能
- **品質ゲート完全達成**: Phase 3の4つの品質ゲート（戦略準拠、正常系カバレッジ、異常系カバレッジ、期待結果の明確性）をすべて満たす
- **後方互換性検証が充実**: 既存の統合テスト（step-commit-push.test.ts）を活用した後方互換性検証シナリオ（3.2節）が明確

**主な改善提案**:
- Git操作失敗時のエラーハンドリングテスト（SUGGESTION: 設計書に記述済み、実装フェーズで補完可能）
- パフォーマンステストの具体的な計測方法の定義（SUGGESTION: 非機能要件、次フェーズで補完可能）
- SecretMaskerエラー時のテストケース追加（SUGGESTION: 設計書に記述済み、実装フェーズで補完可能）

このテストシナリオは、**「80点で十分」の原則を大幅に上回る品質**を達成しています。主要な正常系・異常系がすべてカバーされ、期待結果が明確で、すぐに実装フェーズに移行できる状態です。改善提案はすべて「より良くなる」レベルであり、次フェーズに進めない問題は存在しません。

**Planning Phaseチェックリスト照合結果**: すべてのタスク（Task 3-1、3-2、3-3）が完了しました。planning.mdのチェックボックスを更新しました。

---
**判定: PASS**