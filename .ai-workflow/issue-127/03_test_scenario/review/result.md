test-scenario.mdを詳細にレビューします。まず、Planning Documentを読み込みます。
Planning.mdのPhase 3チェックリストと照合し、テストシナリオを詳細にレビューします。

## 品質ゲート評価

**⚠️ 重要: 各項目に対して明示的にPASS/FAILを判定してください。1つでもFAILがあれば最終判定は自動的にFAILです。**

- [x] **Phase 2の戦略に沿ったテストシナリオである**: **PASS** - セクション2にUnitテストシナリオ、セクション3にIntegrationテストシナリオが明確に分離され、UNIT_INTEGRATION戦略に完全準拠しています。BDDシナリオは含まれておらず、戦略通りです。
- [x] **主要な正常系がカバーされている**: **PASS** - バリデーション正常系（2.1）、parseOptions正常系（2.4）、parseRefactorOutput正常系（2.6）、エージェント実行E2E（3.1）、言語非依存性（3.3）、Issue生成（3.5）など、主要な正常系が十分カバーされています。
- [x] **主要な異常系がカバーされている**: **PASS** - バリデーション異常系（2.2）、境界値テスト（2.3）、parseOptions異常系（2.5）、parseRefactorOutput異常系（2.7）、エラーハンドリング（3.7）など、主要な異常系が十分カバーされています。
- [x] **期待結果が明確である**: **PASS** - すべてのテストケースで具体的な入力値、期待されるデータ構造、エラーメッセージ、ログ出力が明確に記述され、検証可能です。

**品質ゲート総合判定: PASS**
- PASS: 上記4項目すべてがPASS

## Planning Phase チェックリスト照合結果

Planning.mdのPhase 3チェックリストと照合した結果：

### Task 3-1: ユニットテストシナリオ作成 ✅
- `validateRefactorCandidate()` の正常系・異常系 → セクション2.1（正常系）、2.2（異常系）、2.3（境界値）で完全カバー
- `parseOptions` でカテゴリ `'refactor'` を正しく処理するケース → セクション2.4（正常系）、2.5（異常系）で完全カバー
- **追加実装**: `parseRefactorOutput()` のテストケース（2.6, 2.7）、`buildRefactorIssueTitle()` （2.8）、`buildRefactorLabels()` （2.9）も含まれており、Planning以上の網羅性

### Task 3-2: インテグレーションテストシナリオ作成 ✅
- `--category refactor` でリファクタリング候補を検出するE2Eテスト → シナリオ3.1.1, 3.1.2で完全カバー
- dry-runモードでIssue作成をスキップするテスト → シナリオ3.2.1で完全カバー
- TypeScript以外の言語（Python, Go等）でのテストケース設計 → シナリオ3.3.1（Python）、3.3.2（Go）で完全カバー
- **追加実装**: 4つの検出パターンカバレッジテスト（3.1.3）、重複除外機能テスト（3.4）、Issue生成フォーマットテスト（3.5）、エージェントフォールバックテスト（3.6）、Phase 1互換性テスト（セクション4）も含まれており、Planning以上の網羅性

**すべてのタスクが完了しています。** Planning.mdを更新します。
Planning.mdの更新完了。詳細レビューを実施します。

## 詳細レビュー

### 1. テスト戦略との整合性

**良好な点**:
- テスト戦略（UNIT_INTEGRATION）に完全に準拠しており、セクション2でUnitテスト、セクション3でIntegrationテストが明確に分離されています
- セクション1「テスト戦略サマリー」でPhase 2の戦略を明示的に引用し、UNITが必要な理由（バリデーション、オプション解析）、INTEGRATIONが必要な理由（エージェント実行E2E、言語非依存性）、BDD不要の理由を具体的に説明しています
- BDDシナリオが含まれておらず、戦略通りです

**懸念点**:
- なし

### 2. 正常系のカバレッジ

**良好な点**:
- **Unitテスト正常系**: 
  - `validateRefactorCandidate()` の正常系（2.1.1〜2.1.3）で6つのtype全種類をカバー
  - `parseOptions()` の正常系（2.4.1〜2.4.3）でカテゴリ解析とデフォルト値検証
  - `parseRefactorOutput()` の正常系（2.6.1〜2.6.3）でJSON配列、Markdown codeblock、単一オブジェクトの3パターン
  - タイトル生成（2.8）、ラベル生成（2.9）もカバー
- **Integration正常系**:
  - エージェント実行E2E（3.1.1 Codex、3.1.2 Claude）
  - 4つの検出パターンすべてのカバレッジ確認（3.1.3）
  - 言語非依存性（3.3.1 Python、3.3.2 Go）
  - Issue生成（3.5.1 本文フォーマット、3.5.2 ラベル付与）
  - Phase 1互換性（4.1.1〜4.1.3）
- クリティカルパスがすべてカバーされています

**懸念点**:
- なし

### 3. 異常系のカバレッジ

**良好な点**:
- **Unitテスト異常系**:
  - `validateRefactorCandidate()` の異常系（2.2.1〜2.2.6）で必須フィールド欠落、無効なtype、無効なpriority、最小文字数違反を網羅
  - `parseOptions()` の異常系（2.5.1〜2.5.2）で無効なカテゴリ値、空文字列
  - `parseRefactorOutput()` の異常系（2.7.1〜2.7.2）で不正なJSON、空文字列
- **Unitテスト境界値**:
  - 2.3.1〜2.3.3で最小文字数（20文字ちょうど）、すべてのtype値を網羅
- **Integration異常系**:
  - エージェント実行エラー（3.7.1）
  - GitHub API認証エラー（3.7.2）
  - GitHub APIリトライロジック（3.7.3）
  - エージェントフォールバック（3.6.1）
- エラーハンドリングが十分にカバーされています

**改善の余地**:
- なし（十分なカバレッジです）

### 4. 期待結果の明確性

**良好な点**:
- すべてのテストケースで「期待結果」セクションが記載されています
- 具体的な入力値（TypeScriptコードブロック）と期待される出力（boolean、オブジェクト、配列、エラーメッセージ）が明確です
- Integrationテストでは「確認項目」チェックリストがあり、検証可能な形で記述されています
- セクション5「テストデータ」で具体的なサンプルデータを提供しており、実装者がテストを再現しやすくなっています

**懸念点**:
- なし

### 5. 要件との対応

**良好な点**:
- セクション8「受け入れ基準との対応」で、Requirements DocumentのAC-1〜AC-10がすべてカバーされていることを表形式で明示しています
- FR-1（リファクタリング検出エンジン）→ シナリオ3.1.1, 3.1.2
- FR-2（プロンプトテンプレート）→ シナリオ3.1.3（4つの検出パターン）
- FR-3（型定義）→ テストケース2.1.1〜2.1.3
- FR-4（CLIオプション拡張）→ テストケース2.4.1〜2.4.3
- FR-5（Issue生成）→ シナリオ3.5.1, 3.5.2
- FR-6（言語非依存性）→ シナリオ3.3.1, 3.3.2
- FR-7（バリデーション）→ テストケース2.2.1〜2.2.6
- FR-8（重複除外）→ シナリオ3.4.1, 3.4.2
- すべての機能要件がテストシナリオに反映されています

**改善の余地**:
- なし

### 6. 実行可能性

**良好な点**:
- **テストデータ準備**:
  - セクション5でTypeScript、Python、Goのサンプルリポジトリの具体的な内容を定義
  - エージェント出力モック（JSON）を3パターン提供
  - セクション6でテスト環境要件（Node.js、API キー等）を明示
  - セクション6.3でモック/スタブの必要性を明確化（Unitテストではモック、Integrationテストでは実エージェント使用）
- **前提条件**:
  - 各シナリオで「前提条件」セクションが具体的に記載されています（テスト用リポジトリ、APIキー設定等）
- **テスト手順**:
  - Integrationテストで「テスト手順」が段階的に記述されており、実装者が手順通り実行できます
- **確認項目**:
  - Integrationテストで「確認項目」チェックリストがあり、テスト実行結果の検証が容易です

**懸念点**:
- なし

## 改善提案（SUGGESTION）

**次フェーズに進めるが、改善が望ましい事項**

1. **テストデータディレクトリ構造の事前作成**
   - 現状: セクション6.4でディレクトリ構造が定義されているが、実際のファイル作成はPhase 5（テストコード実装）で実施予定
   - 提案: Phase 4（実装）開始前に `test-data/` ディレクトリとサンプルファイルを準備しておくと、Phase 4とPhase 5を並行作業しやすくなります
   - 効果: テスト駆動開発（TDD）が可能になり、実装品質が向上します

2. **パフォーマンステストシナリオの追加（将来拡張）**
   - 現状: 機能テストは網羅されていますが、非機能要件（NFR-1: パフォーマンス要件）のテストシナリオはスコープ外
   - 提案: 将来的に「1000行のリポジトリで5分以内に分析完了」を検証するパフォーマンステストシナリオを追加
   - 効果: 大規模リポジトリでの実用性を保証できます

3. **エラーメッセージの国際化（i18n）考慮（将来拡張）**
   - 現状: テストシナリオのエラーメッセージはすべて英語
   - 提案: 将来的に多言語対応を考慮する場合、エラーメッセージのi18n対応をテストシナリオに追加
   - 効果: グローバルユーザーへの対応が容易になります

**注**: 上記はすべて将来拡張の提案であり、Phase 2 MVPでは対応不要です。現在のテストシナリオは次フェーズ（実装）に進むのに十分です。

## 総合評価

テストシナリオは非常に高品質であり、次フェーズ（実装）に進むための要件をすべて満たしています。

**主な強み**:
- **完全性**: 4つの品質ゲートすべてを満たし、Planning Phaseのチェックリスト（Task 3-1, 3-2）を完全にクリア
- **網羅性**: Unitテスト33ケース、Integrationテスト21シナリオ、リグレッションテスト3シナリオで主要な正常系・異常系・境界値をカバー
- **明確性**: すべてのテストケースで入力・期待結果が具体的に記述され、実装者が迷わずテストを実装できる
- **要件対応**: Requirements DocumentのAC-1〜AC-10すべてがテストシナリオに反映されている
- **実行可能性**: テストデータ、前提条件、テスト手順が明確で、Phase 5（テストコード実装）ですぐに着手可能
- **Phase 1互換性**: セクション4でPhase 1のリグレッションテストを明示し、既存機能の保護を保証
- **構造化**: セクション1（テスト戦略サマリー）でテスト戦略の根拠を明示し、セクション8で受け入れ基準との対応を整理し、レビュアーが理解しやすい

**主な改善提案**:
- テストデータの事前準備（Phase 4開始前）により、TDDを促進
- 将来的なパフォーマンステスト、i18n対応の追加（Phase 3以降）

本テストシナリオは「80点で十分」の原則を大きく上回る品質であり、実装フェーズに進むための十分な基盤を提供しています。Phase 4（実装）とPhase 5（テストコード実装）で本シナリオ通りに実装すれば、高品質なリファクタリング検出機能を実現できます。

---
**判定: PASS**
Planning.mdの更新完了。詳細レビューを実施します。

## 詳細レビュー

### 1. テスト戦略との整合性

**良好な点**:
- テスト戦略（UNIT_INTEGRATION）に完全に準拠しており、セクション2でUnitテスト、セクション3でIntegrationテストが明確に分離されています
- セクション1「テスト戦略サマリー」でPhase 2の戦略を明示的に引用し、UNITが必要な理由（バリデーション、オプション解析）、INTEGRATIONが必要な理由（エージェント実行E2E、言語非依存性）、BDD不要の理由を具体的に説明しています
- BDDシナリオが含まれておらず、戦略通りです

**懸念点**:
- なし

### 2. 正常系のカバレッジ

**良好な点**:
- **Unitテスト正常系**: 
  - `validateRefactorCandidate()` の正常系（2.1.1〜2.1.3）で6つのtype全種類をカバー
  - `parseOptions()` の正常系（2.4.1〜2.4.3）でカテゴリ解析とデフォルト値検証
  - `parseRefactorOutput()` の正常系（2.6.1〜2.6.3）でJSON配列、Markdown codeblock、単一オブジェクトの3パターン
  - タイトル生成（2.8）、ラベル生成（2.9）もカバー
- **Integration正常系**:
  - エージェント実行E2E（3.1.1 Codex、3.1.2 Claude）
  - 4つの検出パターンすべてのカバレッジ確認（3.1.3）
  - 言語非依存性（3.3.1 Python、3.3.2 Go）
  - Issue生成（3.5.1 本文フォーマット、3.5.2 ラベル付与）
  - Phase 1互換性（4.1.1〜4.1.3）
- クリティカルパスがすべてカバーされています

**懸念点**:
- なし

### 3. 異常系のカバレッジ

**良好な点**:
- **Unitテスト異常系**:
  - `validateRefactorCandidate()` の異常系（2.2.1〜2.2.6）で必須フィールド欠落、無効なtype、無効なpriority、最小文字数違反を網羅
  - `parseOptions()` の異常系（2.5.1〜2.5.2）で無効なカテゴリ値、空文字列
  - `parseRefactorOutput()` の異常系（2.7.1〜2.7.2）で不正なJSON、空文字列
- **Unitテスト境界値**:
  - 2.3.1〜2.3.3で最小文字数（20文字ちょうど）、すべてのtype値を網羅
- **Integration異常系**:
  - エージェント実行エラー（3.7.1）
  - GitHub API認証エラー（3.7.2）
  - GitHub APIリトライロジック（3.7.3）
  - エージェントフォールバック（3.6.1）
- エラーハンドリングが十分にカバーされています

**改善の余地**:
- なし（十分なカバレッジです）

### 4. 期待結果の明確性

**良好な点**:
- すべてのテストケースで「期待結果」セクションが記載されています
- 具体的な入力値（TypeScriptコードブロック）と期待される出力（boolean、オブジェクト、配列、エラーメッセージ）が明確です
- Integrationテストでは「確認項目」チェックリストがあり、検証可能な形で記述されています
- セクション5「テストデータ」で具体的なサンプルデータを提供しており、実装者がテストを再現しやすくなっています

**懸念点**:
- なし

### 5. 要件との対応

**良好な点**:
- セクション8「受け入れ基準との対応」で、Requirements DocumentのAC-1〜AC-10がすべてカバーされていることを表形式で明示しています
- FR-1（リファクタリング検出エンジン）→ シナリオ3.1.1, 3.1.2
- FR-2（プロンプトテンプレート）→ シナリオ3.1.3（4つの検出パターン）
- FR-3（型定義）→ テストケース2.1.1〜2.1.3
- FR-4（CLIオプション拡張）→ テストケース2.4.1〜2.4.3
- FR-5（Issue生成）→ シナリオ3.5.1, 3.5.2
- FR-6（言語非依存性）→ シナリオ3.3.1, 3.3.2
- FR-7（バリデーション）→ テストケース2.2.1〜2.2.6
- FR-8（重複除外）→ シナリオ3.4.1, 3.4.2
- すべての機能要件がテストシナリオに反映されています

**改善の余地**:
- なし

### 6. 実行可能性

**良好な点**:
- **テストデータ準備**:
  - セクション5でTypeScript、Python、Goのサンプルリポジトリの具体的な内容を定義
  - エージェント出力モック（JSON）を3パターン提供
  - セクション6でテスト環境要件（Node.js、API キー等）を明示
  - セクション6.3でモック/スタブの必要性を明確化（Unitテストではモック、Integrationテストでは実エージェント使用）
- **前提条件**:
  - 各シナリオで「前提条件」セクションが具体的に記載されています（テスト用リポジトリ、APIキー設定等）
- **テスト手順**:
  - Integrationテストで「テスト手順」が段階的に記述されており、実装者が手順通り実行できます
- **確認項目**:
  - Integrationテストで「確認項目」チェックリストがあり、テスト実行結果の検証が容易です

**懸念点**:
- なし

## 改善提案（SUGGESTION）

**次フェーズに進めるが、改善が望ましい事項**

1. **テストデータディレクトリ構造の事前作成**
   - 現状: セクション6.4でディレクトリ構造が定義されているが、実際のファイル作成はPhase 5（テストコード実装）で実施予定
   - 提案: Phase 4（実装）開始前に `test-data/` ディレクトリとサンプルファイルを準備しておくと、Phase 4とPhase 5を並行作業しやすくなります
   - 効果: テスト駆動開発（TDD）が可能になり、実装品質が向上します

2. **パフォーマンステストシナリオの追加（将来拡張）**
   - 現状: 機能テストは網羅されていますが、非機能要件（NFR-1: パフォーマンス要件）のテストシナリオはスコープ外
   - 提案: 将来的に「1000行のリポジトリで5分以内に分析完了」を検証するパフォーマンステストシナリオを追加
   - 効果: 大規模リポジトリでの実用性を保証できます

3. **エラーメッセージの国際化（i18n）考慮（将来拡張）**
   - 現状: テストシナリオのエラーメッセージはすべて英語
   - 提案: 将来的に多言語対応を考慮する場合、エラーメッセージのi18n対応をテストシナリオに追加
   - 効果: グローバルユーザーへの対応が容易になります

**注**: 上記はすべて将来拡張の提案であり、Phase 2 MVPでは対応不要です。現在のテストシナリオは次フェーズ（実装）に進むのに十分です。

## 総合評価

テストシナリオは非常に高品質であり、次フェーズ（実装）に進むための要件をすべて満たしています。

**主な強み**:
- **完全性**: 4つの品質ゲートすべてを満たし、Planning Phaseのチェックリスト（Task 3-1, 3-2）を完全にクリア
- **網羅性**: Unitテスト33ケース、Integrationテスト21シナリオ、リグレッションテスト3シナリオで主要な正常系・異常系・境界値をカバー
- **明確性**: すべてのテストケースで入力・期待結果が具体的に記述され、実装者が迷わずテストを実装できる
- **要件対応**: Requirements DocumentのAC-1〜AC-10すべてがテストシナリオに反映されている
- **実行可能性**: テストデータ、前提条件、テスト手順が明確で、Phase 5（テストコード実装）ですぐに着手可能
- **Phase 1互換性**: セクション4でPhase 1のリグレッションテストを明示し、既存機能の保護を保証
- **構造化**: セクション1（テスト戦略サマリー）でテスト戦略の根拠を明示し、セクション8で受け入れ基準との対応を整理し、レビュアーが理解しやすい

**主な改善提案**:
- テストデータの事前準備（Phase 4開始前）により、TDDを促進
- 将来的なパフォーマンステスト、i18n対応の追加（Phase 3以降）

本テストシナリオは「80点で十分」の原則を大きく上回る品質であり、実装フェーズに進むための十分な基盤を提供しています。Phase 4（実装）とPhase 5（テストコード実装）で本シナリオ通りに実装すれば、高品質なリファクタリング検出機能を実現できます。

---
**判定: PASS**