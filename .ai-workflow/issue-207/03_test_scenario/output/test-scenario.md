# テストシナリオ書

## 0. Planning Documentの確認

Planning Phase（Phase 0）で策定された開発計画を確認しました。主要な方針は以下の通りです：

- **実装戦略**: EXTEND（既存のプロンプトファイルを修正）
- **テスト戦略**: UNIT_INTEGRATION（ユニットテスト + インテグレーションテスト）
- **テストコード戦略**: EXTEND_TEST（既存テストに追加）
- **見積もり工数**: 8~12時間
- **リスク**: 低（プロンプトファイルの修正のみ、実装コードの変更なし）

この計画に基づき、以下のテストシナリオを策定します。

## 1. テスト戦略サマリー

### 選択されたテスト戦略

**UNIT_INTEGRATION**（Phase 2の設計書より）

### テスト対象の範囲

- **Unitテスト**: プロンプトファイルの読み込み、ビルド後のファイル存在確認
- **Integrationテスト**: Phase 4-8の実際のワークフロー実行、簡潔化された出力ファイルの検証

### テストの目的

1. プロンプトファイルの修正が正しく適用されていることを確認
2. 簡潔化された出力フォーマットが生成されることを確認
3. 既存のワークフローが正常に動作することを確認
4. コンテキスト消費量が削減されることを確認

## 2. Unitテストシナリオ

### UT-1: Phase 4（Implementation）プロンプト読み込みテスト

**テストケース名**: `loadImplementationPrompt_正常系`

- **目的**: Phase 4のプロンプトファイルが正しく読み込まれ、簡潔化されたフォーマット指示が含まれることを検証
- **前提条件**:
  - `src/prompts/implementation/execute.txt` が修正されている
  - プロンプトファイルに「変更ファイル一覧」「主要な変更点」のフォーマット指示が含まれる
- **入力**: なし（ファイル読み込み）
- **期待結果**:
  - プロンプト内容に `変更ファイル一覧` が含まれる
  - プロンプト内容に `主要な変更点` が含まれる
  - プロンプト内容に削除された詳細セクション（`実装詳細` 等）が含まれない
- **テストデータ**: `src/prompts/implementation/execute.txt`

### UT-2: Phase 5（Test Implementation）プロンプト読み込みテスト

**テストケース名**: `loadTestImplementationPrompt_正常系`

- **目的**: Phase 5のプロンプトファイルが正しく読み込まれ、簡潔化されたフォーマット指示が含まれることを検証
- **前提条件**:
  - `src/prompts/test_implementation/execute.txt` が修正されている
  - プロンプトファイルに「テストファイル一覧」「テストカバレッジ」のフォーマット指示が含まれる
- **入力**: なし（ファイル読み込み）
- **期待結果**:
  - プロンプト内容に `テストファイル一覧` が含まれる
  - プロンプト内容に `テストカバレッジ` が含まれる
  - プロンプト内容に削除された詳細セクション（`テストケース詳細` 等）が含まれない
- **テストデータ**: `src/prompts/test_implementation/execute.txt`

### UT-3: Phase 6（Testing）プロンプト読み込みテスト

**テストケース名**: `loadTestingPrompt_正常系`

- **目的**: Phase 6のプロンプトファイルが正しく読み込まれ、成功時/失敗時の条件分岐フォーマット指示が含まれることを検証
- **前提条件**:
  - `src/prompts/testing/execute.txt` が修正されている
  - プロンプトファイルに「テスト結果サマリー」「失敗時のみ詳細記載」のフォーマット指示が含まれる
- **入力**: なし（ファイル読み込み）
- **期待結果**:
  - プロンプト内容に `テスト結果サマリー` が含まれる
  - プロンプト内容に成功時/失敗時の条件分岐指示が含まれる
  - プロンプト内容に「成功したテストの詳細リストは記載しない」旨の指示が含まれる
- **テストデータ**: `src/prompts/testing/execute.txt`

### UT-4: Phase 7（Documentation）プロンプト読み込みテスト

**テストケース名**: `loadDocumentationPrompt_正常系`

- **目的**: Phase 7のプロンプトファイルが正しく読み込まれ、簡潔化されたフォーマット指示が含まれることを検証
- **前提条件**:
  - `src/prompts/documentation/execute.txt` が修正されている
  - プロンプトファイルに「更新サマリー」のテーブルフォーマット指示が含まれる
- **入力**: なし（ファイル読み込み）
- **期待結果**:
  - プロンプト内容に `更新サマリー` が含まれる
  - プロンプト内容に「更新不要と判断したファイルは省略」旨の指示が含まれる
  - プロンプト内容に削除された詳細セクション（`調査したドキュメント` 等）が含まれない
- **テストデータ**: `src/prompts/documentation/execute.txt`

### UT-5: Phase 8（Report）プロンプト読み込みテスト

**テストケース名**: `loadReportPrompt_正常系`

- **目的**: Phase 8のプロンプトファイルが正しく読み込まれ、エグゼクティブサマリー + @references方式のフォーマット指示が含まれることを検証
- **前提条件**:
  - `src/prompts/report/execute.txt` が修正されている
  - プロンプトファイルに「エグゼクティブサマリー」「詳細参照（@references）」のフォーマット指示が含まれる
- **入力**: なし（ファイル読み込み）
- **期待結果**:
  - プロンプト内容に `エグゼクティブサマリー` が含まれる
  - プロンプト内容に `詳細参照` が含まれる
  - プロンプト内容に「@.ai-workflow/issue-{NUM}/」形式の参照パスが含まれる
  - プロンプト内容に「各フェーズの詳細をここに再掲載しない」旨の指示が含まれる
- **テストデータ**: `src/prompts/report/execute.txt`

### UT-6: ビルド後のプロンプトファイル存在確認テスト（Phase 4）

**テストケース名**: `buildPromptFiles_Phase4_正常系`

- **目的**: `npm run build` 実行後、Phase 4のプロンプトファイルが `dist/prompts/` に正しくコピーされることを検証
- **前提条件**:
  - `npm run build` が実行されている
- **入力**: なし（ビルド後の確認）
- **期待結果**:
  - `dist/prompts/implementation/execute.txt` が存在する
  - ファイル内容が `src/prompts/implementation/execute.txt` と同一である
- **テストデータ**: ビルド後の `dist/` ディレクトリ

### UT-7: ビルド後のプロンプトファイル存在確認テスト（Phase 5）

**テストケース名**: `buildPromptFiles_Phase5_正常系`

- **目的**: `npm run build` 実行後、Phase 5のプロンプトファイルが `dist/prompts/` に正しくコピーされることを検証
- **前提条件**:
  - `npm run build` が実行されている
- **入力**: なし（ビルド後の確認）
- **期待結果**:
  - `dist/prompts/test_implementation/execute.txt` が存在する
  - ファイル内容が `src/prompts/test_implementation/execute.txt` と同一である
- **テストデータ**: ビルド後の `dist/` ディレクトリ

### UT-8: ビルド後のプロンプトファイル存在確認テスト（Phase 6）

**テストケース名**: `buildPromptFiles_Phase6_正常系`

- **目的**: `npm run build` 実行後、Phase 6のプロンプトファイルが `dist/prompts/` に正しくコピーされることを検証
- **前提条件**:
  - `npm run build` が実行されている
- **入力**: なし（ビルド後の確認）
- **期待結果**:
  - `dist/prompts/testing/execute.txt` が存在する
  - ファイル内容が `src/prompts/testing/execute.txt` と同一である
- **テストデータ**: ビルド後の `dist/` ディレクトリ

### UT-9: ビルド後のプロンプトファイル存在確認テスト（Phase 7）

**テストケース名**: `buildPromptFiles_Phase7_正常系`

- **目的**: `npm run build` 実行後、Phase 7のプロンプトファイルが `dist/prompts/` に正しくコピーされることを検証
- **前提条件**:
  - `npm run build` が実行されている
- **入力**: なし（ビルド後の確認）
- **期待結果**:
  - `dist/prompts/documentation/execute.txt` が存在する
  - ファイル内容が `src/prompts/documentation/execute.txt` と同一である
- **テストデータ**: ビルド後の `dist/` ディレクトリ

### UT-10: ビルド後のプロンプトファイル存在確認テスト（Phase 8）

**テストケース名**: `buildPromptFiles_Phase8_正常系`

- **目的**: `npm run build` 実行後、Phase 8のプロンプトファイルが `dist/prompts/` に正しくコピーされることを検証
- **前提条件**:
  - `npm run build` が実行されている
- **入力**: なし（ビルド後の確認）
- **期待結果**:
  - `dist/prompts/report/execute.txt` が存在する
  - ファイル内容が `src/prompts/report/execute.txt` と同一である
- **テストデータ**: ビルド後の `dist/` ディレクトリ

### UT-11: Phase 0-2のプロンプトファイルが変更されていないことの確認

**テストケース名**: `earlyPhasePrompts_変更なし確認`

- **目的**: Phase 0-2（Planning, Requirements, Design）のプロンプトファイルが変更されていないことを検証
- **前提条件**:
  - Phase 4-8のプロンプトファイル修正が完了している
- **入力**: なし（ファイル比較）
- **期待結果**:
  - `src/prompts/planning/execute.txt` が変更されていない（gitステータスでunmodified）
  - `src/prompts/requirements/execute.txt` が変更されていない
  - `src/prompts/design/execute.txt` が変更されていない
- **テストデータ**: `src/prompts/` ディレクトリ

## 3. Integrationテストシナリオ

### IT-1: Phase 4（Implementation）出力フォーマット検証

**シナリオ名**: Phase4_実装ログ_簡潔化フォーマット検証

- **目的**: Phase 4を実際に実行し、簡潔化された出力フォーマット（テーブル形式）が生成されることを検証
- **前提条件**:
  - テスト用のIssue（例: Issue #999）が作成されている
  - Phase 4のプロンプトファイルが修正されている
  - `npm run build` が実行されている
- **テスト手順**:
  1. テスト用のIssueでPhase 4（Implementation）を実行: `npm run workflow -- --issue 999 --phase implementation`
  2. 出力ファイル `.ai-workflow/issue-999/04_implementation/output/implementation.md` を読み込む
  3. ファイル内容を検証する
- **期待結果**:
  - `## 変更ファイル一覧` セクションが存在する
  - テーブルフォーマット（`| ファイル | 変更種別 | 概要 |`）が含まれる
  - `## 主要な変更点` セクションが存在する
  - 削除された詳細セクション（`## 実装詳細`、`### ファイル1:`）が含まれない
- **確認項目**:
  - [ ] 「変更ファイル一覧」セクションが存在するか
  - [ ] テーブルフォーマットが正しく生成されているか
  - [ ] 「主要な変更点」が3-5個の箇条書きになっているか
  - [ ] 削除されたセクションが含まれていないか

### IT-2: Phase 5（Test Implementation）出力フォーマット検証

**シナリオ名**: Phase5_テスト実装ログ_簡潔化フォーマット検証

- **目的**: Phase 5を実際に実行し、簡潔化された出力フォーマット（テーブル形式）が生成されることを検証
- **前提条件**:
  - テスト用のIssue（例: Issue #999）が作成されている
  - Phase 5のプロンプトファイルが修正されている
  - `npm run build` が実行されている
- **テスト手順**:
  1. テスト用のIssueでPhase 5（Test Implementation）を実行: `npm run workflow -- --issue 999 --phase test_implementation`
  2. 出力ファイル `.ai-workflow/issue-999/05_test_implementation/output/test-implementation.md` を読み込む
  3. ファイル内容を検証する
- **期待結果**:
  - `## テストファイル一覧` セクションが存在する
  - テーブルフォーマット（`| ファイル | テスト数 | カバー対象 |`）が含まれる
  - `## テストカバレッジ` セクションが数値サマリー形式で存在する
  - 削除された詳細セクション（`## テストケース詳細`）が含まれない
- **確認項目**:
  - [ ] 「テストファイル一覧」セクションが存在するか
  - [ ] テーブルフォーマットが正しく生成されているか
  - [ ] 「テストカバレッジ」が数値サマリー形式になっているか
  - [ ] 削除されたセクションが含まれていないか

### IT-3: Phase 6（Testing）出力フォーマット検証（成功時）

**シナリオ名**: Phase6_テスト結果_成功時サマリーのみ検証

- **目的**: Phase 6を実際に実行し、全テスト成功時にサマリーのみが生成されることを検証
- **前提条件**:
  - テスト用のIssue（例: Issue #999）が作成されている
  - Phase 6のプロンプトファイルが修正されている
  - すべてのテストが成功する状態である
  - `npm run build` が実行されている
- **テスト手順**:
  1. テスト用のIssueでPhase 6（Testing）を実行: `npm run workflow -- --issue 999 --phase testing`
  2. 出力ファイル `.ai-workflow/issue-999/06_testing/output/test-result.md` を読み込む
  3. ファイル内容を検証する
- **期待結果**:
  - `## テスト結果サマリー` セクションが存在する
  - `総テスト数:`, `成功:`, `失敗:`, `成功率:` が含まれる
  - `成功率: 100%` が記載される
  - 成功したテストの詳細リスト（`### 成功したテスト`）が含まれない
- **確認項目**:
  - [ ] 「テスト結果サマリー」セクションが存在するか
  - [ ] 成功率が100%と記載されているか
  - [ ] 成功したテストの詳細リストが削除されているか

### IT-4: Phase 6（Testing）出力フォーマット検証（失敗時）

**シナリオ名**: Phase6_テスト結果_失敗時詳細記載検証

- **目的**: Phase 6を実際に実行し、テスト失敗時にサマリー + 失敗したテストの詳細のみが生成されることを検証
- **前提条件**:
  - テスト用のIssue（例: Issue #998）が作成されている
  - Phase 6のプロンプトファイルが修正されている
  - 一部のテストが失敗する状態である（意図的にテストを失敗させる）
  - `npm run build` が実行されている
- **テスト手順**:
  1. テスト用のIssueでPhase 6（Testing）を実行: `npm run workflow -- --issue 998 --phase testing`
  2. 出力ファイル `.ai-workflow/issue-998/06_testing/output/test-result.md` を読み込む
  3. ファイル内容を検証する
- **期待結果**:
  - `## テスト結果サマリー` セクションが存在する
  - `失敗: X件`（X > 0）が記載される
  - `## 失敗したテスト詳細` セクションが存在する
  - 失敗したテストのエラーメッセージ、スタックトレースが含まれる
  - 成功したテストの詳細リストが含まれない
- **確認項目**:
  - [ ] 「テスト結果サマリー」セクションが存在するか
  - [ ] 失敗件数が正しく記載されているか
  - [ ] 「失敗したテスト詳細」セクションが存在するか
  - [ ] 失敗したテストのエラー情報が記載されているか
  - [ ] 成功したテストの詳細リストが削除されているか

### IT-5: Phase 7（Documentation）出力フォーマット検証

**シナリオ名**: Phase7_ドキュメント更新ログ_簡潔化フォーマット検証

- **目的**: Phase 7を実際に実行し、簡潔化された出力フォーマット（テーブル形式）が生成されることを検証
- **前提条件**:
  - テスト用のIssue（例: Issue #999）が作成されている
  - Phase 7のプロンプトファイルが修正されている
  - `npm run build` が実行されている
- **テスト手順**:
  1. テスト用のIssueでPhase 7（Documentation）を実行: `npm run workflow -- --issue 999 --phase documentation`
  2. 出力ファイル `.ai-workflow/issue-999/07_documentation/output/documentation.md` を読み込む
  3. ファイル内容を検証する
- **期待結果**:
  - `## 更新サマリー` セクションが存在する
  - テーブルフォーマット（`| ファイル | 更新理由 |`）が含まれる
  - 更新不要と判断したファイルのリストが省略されている
  - 削除された詳細セクション（`## 調査したドキュメント`、`## 更新不要と判断したドキュメント`）が含まれない
- **確認項目**:
  - [ ] 「更新サマリー」セクションが存在するか
  - [ ] テーブルフォーマットが正しく生成されているか
  - [ ] 更新不要ファイルのリストが省略されているか
  - [ ] 削除されたセクションが含まれていないか

### IT-6: Phase 8（Report）出力フォーマット検証（エグゼクティブサマリー）

**シナリオ名**: Phase8_最終レポート_エグゼクティブサマリー方式検証

- **目的**: Phase 8を実際に実行し、エグゼクティブサマリー + @references方式のフォーマットが生成されることを検証
- **前提条件**:
  - テスト用のIssue（例: Issue #999）が作成されている
  - Phase 8のプロンプトファイルが修正されている
  - Phase 4-7が実行済みである
  - `npm run build` が実行されている
- **テスト手順**:
  1. テスト用のIssueでPhase 8（Report）を実行: `npm run workflow -- --issue 999 --phase report`
  2. 出力ファイル `.ai-workflow/issue-999/08_report/output/report.md` を読み込む
  3. ファイル内容を検証する
- **期待結果**:
  - `## エグゼクティブサマリー` セクションが存在する
  - Issue番号、タイトル、実装内容、変更規模、テスト結果、マージ推奨が含まれる
  - `## マージチェックリスト` セクションが簡潔化されている
  - `## 詳細参照` セクションが存在する
  - `@.ai-workflow/issue-999/01_requirements/output/requirements.md` 形式の参照パスが含まれる
  - 削除された詳細再掲載セクション（`## 要件定義サマリー`、`## 設計サマリー`）が含まれない
- **確認項目**:
  - [ ] 「エグゼクティブサマリー」セクションが存在するか
  - [ ] マージ推奨（✅ / ⚠️ / ❌）が記載されているか
  - [ ] 「詳細参照」セクションが存在するか
  - [ ] @references形式のパスが正しく記載されているか
  - [ ] 削除された詳細再掲載セクションが含まれていないか

### IT-7: 全体ワークフロー実行テスト（Phase 4-8連続実行）

**シナリオ名**: 全体ワークフロー_Phase4-8連続実行_正常動作検証

- **目的**: Phase 4-8を連続して実行し、全フェーズが正常に動作することを検証
- **前提条件**:
  - テスト用のIssue（例: Issue #997）が作成されている
  - Phase 4-8のプロンプトファイルがすべて修正されている
  - `npm run build` が実行されている
- **テスト手順**:
  1. テスト用のIssueでPhase 4-8を連続実行: `npm run workflow -- --issue 997 --preset implementation`
  2. 各フェーズの出力ファイルが生成されているか確認
  3. 各フェーズの出力フォーマットが簡潔化されているか確認
- **期待結果**:
  - Phase 4-8のすべてのフェーズが成功する
  - 各フェーズの出力ファイルが簡潔化されたフォーマットで生成される
  - Phase 8でコンテキスト制限エラーが発生しない
  - 後続フェーズ（Phase 9）が正常に参照できる
- **確認項目**:
  - [ ] Phase 4-8のすべてが成功したか
  - [ ] 各フェーズの出力フォーマットが簡潔化されているか
  - [ ] コンテキスト制限エラーが発生していないか
  - [ ] 後続フェーズが正常に動作するか

### IT-8: コンテキスト消費量削減効果検証

**シナリオ名**: コンテキスト消費量_Phase8削減効果検証

- **目的**: Phase 8の出力ファイルサイズが修正前より30-50%削減されていることを検証
- **前提条件**:
  - 修正前のPhase 8出力ファイルサイズが記録されている（ベースライン）
  - テスト用のIssue（例: Issue #996）が作成されている
  - Phase 8のプロンプトファイルが修正されている
  - `npm run build` が実行されている
- **テスト手順**:
  1. テスト用のIssueでPhase 8（Report）を実行: `npm run workflow -- --issue 996 --phase report`
  2. 出力ファイル `.ai-workflow/issue-996/08_report/output/report.md` のファイルサイズを取得
  3. 修正前のファイルサイズと比較し、削減率を計算
- **期待結果**:
  - 削減率が30-50%の範囲内である
  - 式: `削減率 = (修正前サイズ - 修正後サイズ) / 修正前サイズ`
  - `0.3 <= 削減率 <= 0.5`
- **確認項目**:
  - [ ] ファイルサイズが削減されているか
  - [ ] 削減率が30%以上であるか
  - [ ] 削減率が50%以下であるか（削減しすぎていないか）

### IT-9: Phase 0-2の出力フォーマット不変性検証

**シナリオ名**: Phase0-2_出力フォーマット_変更なし検証

- **目的**: Phase 0-2（Planning, Requirements, Design）を実際に実行し、出力フォーマットが変更前と同一であることを検証
- **前提条件**:
  - テスト用のIssue（例: Issue #995）が作成されている
  - Phase 4-8のプロンプトファイル修正が完了している
  - Phase 0-2のプロンプトファイルは変更されていない
  - `npm run build` が実行されている
- **テスト手順**:
  1. テスト用のIssueでPhase 0-2を実行: `npm run workflow -- --issue 995 --preset planning`
  2. 各フェーズの出力ファイルを読み込む
  3. 出力フォーマットが変更前と同様に詳細であることを確認
- **期待結果**:
  - Phase 0の出力ファイル（`planning.md`）が詳細なフォーマットで生成される
  - Phase 1の出力ファイル（`requirements.md`）が詳細なフォーマットで生成される
  - Phase 2の出力ファイル（`design.md`）が詳細なフォーマットで生成される
  - 簡潔化の影響を受けていない
- **確認項目**:
  - [ ] Phase 0の出力が詳細なフォーマットであるか
  - [ ] Phase 1の出力が詳細なフォーマットであるか
  - [ ] Phase 2の出力が詳細なフォーマットであるか
  - [ ] 簡潔化の影響を受けていないか

### IT-10: 後方互換性検証（出力ファイル名）

**シナリオ名**: 後方互換性_出力ファイル名_不変性検証

- **目的**: プロンプト修正後も、出力ファイル名が変更されていないことを検証
- **前提条件**:
  - テスト用のIssue（例: Issue #994）が作成されている
  - Phase 4-8のプロンプトファイル修正が完了している
  - `npm run build` が実行されている
- **テスト手順**:
  1. テスト用のIssueでPhase 4-8を実行
  2. 各フェーズの出力ファイル名を確認
- **期待結果**:
  - Phase 4の出力ファイル名が `implementation.md` である
  - Phase 5の出力ファイル名が `test-implementation.md` である
  - Phase 6の出力ファイル名が `test-result.md` である
  - Phase 7の出力ファイル名が `documentation.md` である
  - Phase 8の出力ファイル名が `report.md` である
- **確認項目**:
  - [ ] Phase 4の出力ファイル名が変更されていないか
  - [ ] Phase 5の出力ファイル名が変更されていないか
  - [ ] Phase 6の出力ファイル名が変更されていないか
  - [ ] Phase 7の出力ファイル名が変更されていないか
  - [ ] Phase 8の出力ファイル名が変更されていないか

## 4. テストデータ

### テスト用Issue

**Issue #999（正常系テスト用）**:
- **タイトル**: "Test: 簡潔化フォーマット検証用Issue（正常系）"
- **本文**: 簡単な機能追加を想定（例: 新規関数の追加）
- **用途**: IT-1, IT-2, IT-3, IT-5, IT-6のテストデータ

**Issue #998（テスト失敗ケース用）**:
- **タイトル**: "Test: 簡潔化フォーマット検証用Issue（テスト失敗ケース）"
- **本文**: 意図的にテストが失敗するケースを想定
- **用途**: IT-4のテストデータ

**Issue #997（全体ワークフロー用）**:
- **タイトル**: "Test: Phase 4-8連続実行検証用Issue"
- **本文**: 中規模の機能追加を想定
- **用途**: IT-7のテストデータ

**Issue #996（コンテキスト削減検証用）**:
- **タイトル**: "Test: コンテキスト消費量削減検証用Issue"
- **本文**: 修正前と同等の規模のIssueを想定（ベースラインとの比較用）
- **用途**: IT-8のテストデータ

**Issue #995（Phase 0-2不変性検証用）**:
- **タイトル**: "Test: 序盤フェーズ出力フォーマット不変性検証用Issue"
- **本文**: 簡単な機能追加を想定
- **用途**: IT-9のテストデータ

**Issue #994（後方互換性検証用）**:
- **タイトル**: "Test: 出力ファイル名後方互換性検証用Issue"
- **本文**: 簡単な機能追加を想定
- **用途**: IT-10のテストデータ

### プロンプトファイルテストデータ

- `src/prompts/implementation/execute.txt`（修正後）
- `src/prompts/test_implementation/execute.txt`（修正後）
- `src/prompts/testing/execute.txt`（修正後）
- `src/prompts/documentation/execute.txt`（修正後）
- `src/prompts/report/execute.txt`（修正後）
- `src/prompts/planning/execute.txt`（変更なし）
- `src/prompts/requirements/execute.txt`（変更なし）
- `src/prompts/design/execute.txt`（変更なし）

### ベースラインデータ（コンテキスト削減検証用）

- 修正前のPhase 8出力ファイルサイズ: 約50KB（仮）
- 修正後の目標ファイルサイズ: 25-35KB（30-50%削減）

## 5. テスト環境要件

### 必要なテスト環境

- **ローカル環境**:
  - Node.js 20以上
  - npm 10以上
  - TypeScriptビルド環境（`npm run build` が正常に動作すること）
- **CI/CD環境**:
  - GitHub Actions（将来的に自動化する場合）
  - テスト用のリポジトリ環境

### 必要な外部サービス

- **GitHub API**: Issue取得、コメント投稿
- **Codex / Claude エージェント**: プロンプト実行環境

### モック/スタブの必要性

- **Unitテスト**: モック不要（ファイル読み込みテストのみ）
- **Integrationテスト**: モック不要（実際のワークフロー実行）

### テスト実行コマンド

```bash
# Unitテスト実行
npm run test:unit

# Integrationテスト実行（手動）
npm run workflow -- --issue 999 --phase implementation
npm run workflow -- --issue 999 --phase test_implementation
npm run workflow -- --issue 999 --phase testing
npm run workflow -- --issue 999 --phase documentation
npm run workflow -- --issue 999 --phase report

# 全体ワークフロー実行
npm run workflow -- --issue 997 --preset implementation

# ビルド確認
npm run build
ls -la dist/prompts/
```

## 6. テストシナリオ実行順序

テストシナリオは以下の順序で実行することを推奨します：

### ステップ1: Unitテスト実行
1. UT-1 ~ UT-10を実行
2. すべてのUnitテストが成功することを確認

### ステップ2: Integrationテスト準備
1. テスト用のIssue #999, #998, #997, #996, #995, #994を作成
2. `npm run build` を実行し、プロンプトファイルがdist/にコピーされることを確認

### ステップ3: Integrationテスト実行（個別フェーズ）
1. IT-1（Phase 4出力検証）
2. IT-2（Phase 5出力検証）
3. IT-3（Phase 6成功時検証）
4. IT-4（Phase 6失敗時検証）
5. IT-5（Phase 7出力検証）
6. IT-6（Phase 8出力検証）

### ステップ4: Integrationテスト実行（全体フロー）
1. IT-7（Phase 4-8連続実行検証）
2. IT-8（コンテキスト削減検証）
3. IT-9（Phase 0-2不変性検証）
4. IT-10（後方互換性検証）

### ステップ5: テスト結果の集計
1. すべてのテストケースの成功/失敗を集計
2. 失敗したテストケースの原因を分析
3. 必要に応じてプロンプトファイルを修正し、再テスト

## 7. テストカバレッジ目標

### Unitテストカバレッジ

- **プロンプトファイル読み込み**: 100%（Phase 4-8のすべてのプロンプトファイル）
- **ビルド後ファイル存在確認**: 100%（Phase 4-8のすべてのプロンプトファイル）
- **Phase 0-2不変性確認**: 100%（Phase 0-2のすべてのプロンプトファイル）

### Integrationテストカバレッジ

- **Phase 4-8の出力フォーマット検証**: 100%（Phase 4-8のすべてのフェーズ）
- **成功時/失敗時の条件分岐**: 100%（Phase 6の成功時/失敗時）
- **全体ワークフロー**: 100%（Phase 4-8連続実行）
- **コンテキスト削減効果**: 100%（Phase 8のファイルサイズ検証）

### 受け入れ基準とのマッピング

| 受け入れ基準 | テストシナリオ |
|-------------|--------------|
| AC-1: Phase 4プロンプト修正 | UT-1, IT-1 |
| AC-2: Phase 5プロンプト修正 | UT-2, IT-2 |
| AC-3: Phase 6プロンプト修正 | UT-3, IT-3, IT-4 |
| AC-4: Phase 7プロンプト修正 | UT-4, IT-5 |
| AC-5: Phase 8プロンプト修正 | UT-5, IT-6 |
| AC-6: Phase 0-2は変更されない | UT-11, IT-9 |
| AC-7: ビルドテスト | UT-6 ~ UT-10 |
| AC-8: インテグレーションテスト | IT-7 |
| AC-9: コンテキスト削減効果の検証 | IT-8 |

## 8. リスクベースのテスト優先度

### 高優先度テスト（Critical Path）

以下のテストケースは**必須**です：

1. **IT-6（Phase 8出力検証）**: コンテキスト制限問題の解決が主目的のため、Phase 8のテストが最重要
2. **IT-8（コンテキスト削減検証）**: Issue #202の解決効果を検証するため
3. **IT-7（全体ワークフロー検証）**: 既存のワークフローが壊れていないことを確認するため

### 中優先度テスト

以下のテストケースは**推奨**です：

1. **IT-1 ~ IT-5（Phase 4-7出力検証）**: 各フェーズの簡潔化が正しく適用されているか確認
2. **IT-9（Phase 0-2不変性検証）**: 序盤フェーズが変更されていないことを確認
3. **IT-10（後方互換性検証）**: 出力ファイル名が変更されていないことを確認

### 低優先度テスト

以下のテストケースは**オプション**です：

1. **UT-1 ~ UT-11（Unitテスト）**: 時間があれば実施（手動でも確認可能）

## 9. テスト実行時の注意事項

### 1. テストデータの準備

- テスト用のIssueは、実際のIssueとは別に作成すること
- Issue番号は900番台を使用すること（実際のIssueと区別するため）
- テスト実行後、テスト用のIssueはクローズすること

### 2. テスト環境のクリーンアップ

- テスト実行前に `.ai-workflow/issue-9XX/` ディレクトリを削除すること
- テスト実行後、`.ai-workflow/issue-9XX/` ディレクトリを削除すること（必要に応じて保持）

### 3. ベースラインデータの取得

- IT-8（コンテキスト削減検証）を実行する前に、修正前のPhase 8出力ファイルサイズを記録すること
- 同等の規模のIssueで比較すること（Issue内容の複雑度が同じであること）

### 4. テスト失敗時の対応

- テストが失敗した場合、プロンプトファイルの修正を見直すこと
- 失敗したテストケースの原因を分析し、修正後に再テストすること
- 品質ゲート（次のセクション参照）を満たさない場合、修正が必須

## 10. 品質ゲート（Phase 3）

テストシナリオは以下の品質ゲートを満たす必要があります：

- [x] **Phase 2の戦略に沿ったテストシナリオである**: UNIT_INTEGRATION戦略に基づき、Unitテストシナリオ（UT-1 ~ UT-11）とIntegrationテストシナリオ（IT-1 ~ IT-10）を作成
- [x] **主要な正常系がカバーされている**: IT-1 ~ IT-3, IT-5, IT-6, IT-7で各フェーズの正常系をカバー
- [x] **主要な異常系がカバーされている**: IT-4でPhase 6のテスト失敗ケースをカバー
- [x] **期待結果が明確である**: すべてのテストケースで具体的な期待結果を記載

## 11. まとめ

本テストシナリオ書では、Issue #207「中盤フェーズ（Phase 4-8）の出力ドキュメント簡潔化」のテストシナリオを策定しました。

### テスト戦略

- **UNIT_INTEGRATION戦略**: Unitテスト（11ケース）とIntegrationテスト（10ケース）を作成

### 主要なテストポイント

1. **プロンプトファイルの簡潔化**: Phase 4-8のプロンプトファイルが正しく修正されているか
2. **出力フォーマットの簡潔化**: 各フェーズで簡潔化された出力が生成されるか
3. **コンテキスト削減効果**: Phase 8の出力ファイルサイズが30-50%削減されるか
4. **後方互換性**: 既存のワークフローが正常に動作するか
5. **Phase 0-2の不変性**: 序盤フェーズが変更されていないか

### テスト実行順序

1. Unitテスト実行（UT-1 ~ UT-11）
2. Integrationテスト準備（テスト用Issue作成、ビルド実行）
3. Integrationテスト実行（個別フェーズ: IT-1 ~ IT-6）
4. Integrationテスト実行（全体フロー: IT-7 ~ IT-10）
5. テスト結果の集計と分析

次のフェーズ（Phase 4: Implementation）では、本テストシナリオに基づいてプロンプトファイルの修正を実施します。
